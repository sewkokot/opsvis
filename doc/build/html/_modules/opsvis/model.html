

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>opsvis.model &mdash; opsvis 0.99.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=f5127f15" />

  
      <script src="../../_static/jquery.js?v=8dae8fb0"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=ce4adff3"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            opsvis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plot_model.html">plot_model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_defo.html">plot_defo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_load.html">plot_load</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_mode_shape.html">plot_mode_shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../section_force_diagram_2d.html">section_force_diagram_2d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../section_force_diagram_3d.html">section_force_diagram_3d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_strain.html">plot_strain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_stress_2d.html">plot_stress_2d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_extruded_model_rect_section_3d.html">plot_extruded_model_rect_section_3d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anim_defo.html">anim_defo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anim_mode.html">anim_mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_fiber_section.html">plot_fiber_section</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fib_sec_list_to_cmds.html">fib_sec_list_to_cmds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sig_out_per_node.html">sig_out_per_node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">opsvis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">opsvis.model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for opsvis.model</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">openseespy.opensees</span> <span class="k">as</span> <span class="nn">ops</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PolyCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Wedge</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">tri</span>

<span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.defo</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">FancyArrowPatch</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.proj3d</span> <span class="kn">import</span> <span class="n">proj_transform</span>


<span class="c1"># from https://gist.github.com/WetHat/1d6cd0f7309535311a539b42cccca89c</span>
<span class="k">class</span> <span class="nc">Arrow3D</span><span class="p">(</span><span class="n">FancyArrowPatch</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dxdydz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dxdydz</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">dz</span><span class="p">)</span>

        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="n">proj_transform</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_3d_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dxdydz</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">dz</span><span class="p">)</span>

        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="n">proj_transform</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_arrow3D</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Add an 3d arrow to an `Axes3D` instance.&#39;&#39;&#39;</span>

    <span class="n">arrow</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>


<span class="nb">setattr</span><span class="p">(</span><span class="n">Axes3D</span><span class="p">,</span> <span class="s1">&#39;arrow3D&#39;</span><span class="p">,</span> <span class="n">_arrow3D</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_plot_model_2d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span>
                   <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span> <span class="n">fmt_model</span><span class="p">,</span>
                   <span class="n">fmt_model_nodes_only</span><span class="p">,</span> <span class="n">node_supports</span><span class="p">,</span> <span class="n">gauss_points</span><span class="p">,</span> <span class="n">fmt_gauss_points</span><span class="p">,</span>
                   <span class="n">fmt_model_truss</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_wi_he</span><span class="p">:</span>
            <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fig_lbrt</span><span class="p">:</span>
            <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">fleft</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fbottom</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">fright</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ftop</span><span class="p">)</span>

    <span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_crd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="c1"># nodes only in the OpenSees domain</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">nodes_only</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model_nodes_only</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x_crd</span> <span class="o">&gt;</span> <span class="n">max_x_crd</span><span class="p">:</span>
            <span class="n">max_x_crd</span> <span class="o">=</span> <span class="n">x_crd</span>
        <span class="k">if</span> <span class="n">y_crd</span> <span class="o">&gt;</span> <span class="n">max_y_crd</span><span class="p">:</span>
            <span class="n">max_y_crd</span> <span class="o">=</span> <span class="n">y_crd</span>

    <span class="n">max_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">])</span>
    <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">max_crd</span>
    <span class="n">_offnl</span> <span class="o">=</span> <span class="mf">0.003</span> <span class="o">*</span> <span class="n">max_crd</span>

    <span class="c1"># 0. first print node labels</span>
    <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_tags</span><span class="p">):</span>
            <span class="c1"># xycrd = ops.nodeCoord(node_tag)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="s1">&#39;above&#39;</span><span class="p">:</span>
                <span class="n">offset_nd_label_x</span><span class="p">,</span> <span class="n">offset_nd_label_y</span> <span class="o">=</span> <span class="n">_offnl</span><span class="p">,</span> <span class="n">_offnl</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                <span class="c1"># va = &#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offset_nd_label_x</span><span class="p">,</span> <span class="n">offset_nd_label_y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offnl</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset_nd_label_x</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset_nd_label_y</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam2d</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn2d</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn2d</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TimoshenkoBeamColumn2d</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticTimoshenkoBeam2d</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">MVLEM</span>
                <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SFI_MVLEM</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ecrd_eles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ecrd_nodes</span><span class="p">)</span>

            <span class="n">ele_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;offsets&#39;</span><span class="p">))</span>
            <span class="n">nz_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ele_offsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># tuple of arrays</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nz_offsets</span><span class="p">):</span>
                <span class="c1"># modify ecrd_eles</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                        <span class="o">**</span><span class="n">fmt_model_rigid_offset</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                        <span class="o">**</span><span class="n">fmt_model_rigid_offset</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">gauss_points</span><span class="p">:</span>
                <span class="n">Lgps</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;integrationPoints&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">Lgpi</span> <span class="ow">in</span> <span class="n">Lgps</span><span class="p">:</span>
                    <span class="n">dxi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">Lgpi</span> <span class="o">/</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                    <span class="n">dyi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">Lgpi</span> <span class="o">/</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxi</span><span class="p">,</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dyi</span><span class="p">,</span> <span class="o">**</span><span class="n">fmt_gauss_points</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ele_classtag</span> <span class="ow">in</span> <span class="p">[</span><span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">,</span><span class="n">EleClassTag</span><span class="o">.</span><span class="n">trussSection</span><span class="p">,</span><span class="n">EleClassTag</span><span class="o">.</span><span class="n">CorotTruss</span><span class="p">]:</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>


            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="k">if</span> <span class="n">truss_node_offset</span><span class="p">:</span>
                <span class="n">Lx</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">Ly</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">dLx</span> <span class="o">=</span> <span class="n">truss_node_offset</span> <span class="o">*</span> <span class="n">Lx</span>
                <span class="n">dLy</span> <span class="o">=</span> <span class="n">truss_node_offset</span> <span class="o">*</span> <span class="n">Ly</span>

                <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dLx</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dLx</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dLy</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dLy</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model_truss</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d triangular (tri31) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad8n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad9n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">9</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="c1"># 2d triangle (tri6n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d joint2d element plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">Joint2D</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">5</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label - central node</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="o">**</span><span class="n">fmt_model_joint2d</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d zeroLength, two node link element plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ZeroLength</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TwoNodeLink</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># ax.plot([ecrd[0, 0], ecrd[2, 0], ecrd[2, 0], ecrd[0, 0],</span>
            <span class="c1">#          ecrd[0, 0]],</span>
            <span class="c1">#         [ecrd[1, 1], ecrd[1, 1], ecrd[3, 1], ecrd[3, 1],</span>
            <span class="c1">#          ecrd[1, 1]], **fmt_model_joint2d)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">node_supports</span><span class="p">:</span>
        <span class="n">_plot_supports</span><span class="p">(</span><span class="n">node_tags</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">_plot_supports</span><span class="p">(</span><span class="n">node_tags</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># fix 2d support: square</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>

    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

    <span class="n">path_fix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="c1"># hinge/pin 2d support: ^</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>

    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

    <span class="n">path_pin</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="c1"># roller horiz 2d support: o_</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">)]</span>

    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>

    <span class="n">path_roller_horiz</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="c1"># roller vert 2d support: o|</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)]</span>

    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
             <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>

    <span class="n">path_roller_vert</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">m_color</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
    <span class="n">m_fstyle</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
    <span class="n">m_size</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="n">fixed_nodes</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getFixedNodes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">fixed_nodes</span><span class="p">:</span>
        <span class="n">nd_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="n">fixed_dofs</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getFixedDOFs</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_fix</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_pin</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_roller_vert</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_roller_horiz</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">m_type</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">m_size</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">m_color</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="n">m_fstyle</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_fix</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">fixed_dofs</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="n">path_pin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m_type</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">m_type</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">m_size</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">m_color</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="n">m_fstyle</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">_plot_model_3d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span>
                   <span class="n">axis_off</span><span class="p">,</span> <span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">local_axes</span><span class="p">,</span>
                   <span class="n">nodes_only</span><span class="p">,</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">node_supports</span><span class="p">,</span> <span class="n">gauss_points</span><span class="p">,</span>
                   <span class="n">fmt_gauss_points</span><span class="p">,</span> <span class="n">fmt_model_truss</span><span class="p">,</span>
                   <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_wi_he</span><span class="p">:</span>
            <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">))</span>
            <span class="c1"># fig.subplots_adjust(left=.08, bottom=.08, right=.985, top=.94)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fig_lbrt</span><span class="p">:</span>
            <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">fleft</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fbottom</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">fright</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ftop</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_z_crd</span><span class="p">,</span> <span class="n">max_crd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> \
        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># nodes only in the OpenSees domain</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">nodes_only</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x_crd</span> <span class="o">&gt;</span> <span class="n">max_x_crd</span><span class="p">:</span>
            <span class="n">max_x_crd</span> <span class="o">=</span> <span class="n">x_crd</span>
        <span class="k">if</span> <span class="n">y_crd</span> <span class="o">&gt;</span> <span class="n">max_y_crd</span><span class="p">:</span>
            <span class="n">max_y_crd</span> <span class="o">=</span> <span class="n">y_crd</span>
        <span class="k">if</span> <span class="n">z_crd</span> <span class="o">&gt;</span> <span class="n">max_z_crd</span><span class="p">:</span>
            <span class="n">max_z_crd</span> <span class="o">=</span> <span class="n">z_crd</span>

    <span class="k">if</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_z_crd</span><span class="p">])</span>
        <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">max_crd</span>

    <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticTimoshenkoBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">Pipe</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">CurvedPipe</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ecrd_eles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ecrd_nodes</span><span class="p">)</span>

            <span class="n">ele_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;offsets&#39;</span><span class="p">))</span>
            <span class="n">nz_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ele_offsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># tuple of arrays</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nz_offsets</span><span class="p">):</span>
                <span class="c1"># modify ecrd_eles</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                        <span class="o">**</span><span class="n">fmt_model_rigid_offset</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">ecrd_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                        <span class="o">**</span><span class="n">fmt_model_rigid_offset</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>
            <span class="c1"># ax.plot(ecrd[:, 0], ecrd[:, 1], ecrd[:, 2], **fmt_model)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="c1"># fixme: placement of node_tag labels</span>
            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span> <span class="o">+</span> <span class="n">offset_x</span><span class="p">,</span>
                        <span class="n">yt</span> <span class="o">+</span> <span class="n">offset_y</span><span class="p">,</span>
                        <span class="n">zt</span> <span class="o">+</span> <span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">local_axes</span><span class="p">:</span>
                <span class="c1"># eo = Eo[i, :]</span>
                <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
                <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
                <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                <span class="n">alen</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">L</span>

                <span class="c1"># plot local axis directional vectors: workaround quiver = arrow</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                          <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                          <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                          <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">gauss_points</span><span class="p">:</span>
                <span class="n">Lgps</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;integrationPoints&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">Lgpi</span> <span class="ow">in</span> <span class="n">Lgps</span><span class="p">:</span>
                    <span class="n">dxi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">Lgpi</span> <span class="o">/</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                    <span class="n">dyi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">Lgpi</span> <span class="o">/</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                    <span class="n">dzi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">Lgpi</span> <span class="o">/</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxi</span><span class="p">,</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dyi</span><span class="p">,</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dzi</span><span class="p">,</span> <span class="o">**</span><span class="n">fmt_gauss_points</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span>
              <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">trussSection</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="k">if</span> <span class="n">truss_node_offset</span><span class="p">:</span>
                <span class="n">Lx</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">Ly</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">Lz</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">dLx</span> <span class="o">=</span> <span class="n">truss_node_offset</span> <span class="o">*</span> <span class="n">Lx</span>
                <span class="n">dLy</span> <span class="o">=</span> <span class="n">truss_node_offset</span> <span class="o">*</span> <span class="n">Ly</span>
                <span class="n">dLz</span> <span class="o">=</span> <span class="n">truss_node_offset</span> <span class="o">*</span> <span class="n">Lz</span>

                <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dLx</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dLx</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dLy</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dLy</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dLz</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dLz</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model_truss</span><span class="p">)</span>

            <span class="c1"># fixme: placement of node_tag labels</span>
            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># quad in 3d</span>
        <span class="c1"># elif nen == 4:</span>
        <span class="k">elif</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">FourNodeTetrahedron</span><span class="p">:</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="ow">in</span> <span class="p">{</span><span class="n">EleClassTag</span><span class="o">.</span><span class="n">TenNodeTetrahedron</span><span class="p">,</span>
                               <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TenNodeTetrahedronSK</span><span class="p">}):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellMITC4</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ASDShellQ4</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellNLDKGQ</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellDKGQ</span> <span class="ow">or</span>                            
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellNLDKGT</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellDKGT</span><span class="p">):</span>
            
            <span class="n">nen</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>
            
        <span class="c1"># mvlem 3d plot model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">MVLEM_3D</span>
              <span class="ow">or</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SFI_MVLEM_3D</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="c1"># 8-node brick, 3d model</span>
        <span class="c1"># elif nen == 8:</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick8n</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SSPbrick</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bottom face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="c1"># 20-node brick, 3d model</span>
        <span class="c1"># elif nen == 20:</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick20n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bottom face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">fmt_model</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="c1"># for j in range(2):</span>
            <span class="c1">#     ax.plot(ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 0],</span>
            <span class="c1">#             ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 1],</span>
            <span class="c1">#             ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 2],</span>
            <span class="c1">#             **fmt_model, mfc=&#39;g&#39;, mec=&#39;g&#39;)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt_model</span><span class="p">,</span>
                        <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">nen</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="c1"># 3d zeroLength, two node link element plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ZeroLength</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TwoNodeLink</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># ax.plot([ecrd[0, 0], ecrd[2, 0], ecrd[2, 0], ecrd[0, 0],</span>
            <span class="c1">#          ecrd[0, 0]],</span>
            <span class="c1">#         [ecrd[1, 1], ecrd[1, 1], ecrd[3, 1], ecrd[3, 1],</span>
            <span class="c1">#          ecrd[1, 1]], **fmt_model_joint2d)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">node_supports</span><span class="p">:</span>
        <span class="n">_plot_supports</span><span class="p">(</span><span class="n">node_tags</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_zlim3d</span><span class="p">())))</span>

    <span class="k">return</span> <span class="n">ax</span>


<div class="viewcode-block" id="plot_model">
<a class="viewcode-back" href="../../plot_model.html#opsvis.plot_model">[docs]</a>
<span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">element_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">axis_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">fig_lbrt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">local_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nodes_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">fmt_model</span><span class="o">=</span><span class="n">fmt_model</span><span class="p">,</span>
               <span class="n">fmt_model_nodes_only</span><span class="o">=</span><span class="n">fmt_model_nodes_only</span><span class="p">,</span>
               <span class="n">node_supports</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gauss_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">fmt_gauss_points</span><span class="o">=</span><span class="n">fmt_gauss_points</span><span class="p">,</span>
               <span class="n">fmt_model_truss</span><span class="o">=</span><span class="n">fmt_model_truss</span><span class="p">,</span>
               <span class="n">truss_node_offset</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot defined model of the structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_labels (int): 1 - plot node labels, 0 - do not plot them;</span>
<span class="sd">            (default: 1)</span>

<span class="sd">        element_labels (int): 1 - plot element labels, 0 - do not plot</span>
<span class="sd">            them; (default: 1)</span>

<span class="sd">        offset_nd_label (bool): False - do not offset node labels from the</span>
<span class="sd">            actual node location. This option can enhance visibility.</span>

<span class="sd">        axis_off (int): 0 - turn off axes, 1 - display axes; (default: 0)</span>

<span class="sd">        az_el (tuple): contains azimuth and elevation for 3d plots. For 2d</span>
<span class="sd">            plots this parameter is neglected.</span>

<span class="sd">        fig_wi_he (tuple): contains width and height of the figure</span>

<span class="sd">        fig_lbrt (tuple): a tuple contating left, bottom, right and top offsets</span>

<span class="sd">        local_axes (bool): True - show cross section local axes or False.</span>
<span class="sd">            The green, red and blue arrows denote the element axis direction,</span>
<span class="sd">            the z-local axis and the y-local axis.</span>

<span class="sd">        nodes_only (bool): True - show the nodes only, although the elements</span>
<span class="sd">            are defined. Default: False.</span>

<span class="sd">        fmt_model (dict): A dictionary containing formatting the line and markers</span>
<span class="sd">            of the model elements. The formatting options can be: linewidth, color,</span>
<span class="sd">            marker, markersize. See matplotlib.plot documentation for more details,</span>
<span class="sd">            if necessary.</span>

<span class="sd">        node_supports (bool): True - show the supports. Default: True.</span>

<span class="sd">        gauss_points (bool): True - show the integration (Gauss) points. Default: True.</span>

<span class="sd">        fmt_gauss_points (dict): A dictionary containing formatting the marker</span>
<span class="sd">            of the gauss point.</span>

<span class="sd">        truss_node_offset (float): If non-zero, the nodes are offset to show pin markers.</span>
<span class="sd">            The number should preferably be between 0.90-0.97.</span>
<span class="sd">            Zero (0) or False means no offset. Default: 0.96.</span>

<span class="sd">        ax: axis object.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ``plot_model()`` - plot model with node and element labels.</span>

<span class="sd">    ``plot_model(node_labels=0, element_labels=0)`` - plot model without node</span>
<span class="sd">    element labels</span>

<span class="sd">    ``plot_model(fig_wi_he=(20., 14.))`` - plot model in a window 20 cm long,</span>
<span class="sd">    and 14 cm high.</span>

<span class="sd">    ``plot_model(nodes_only=True)`` - plot only the nodes even thought the elements</span>
<span class="sd">    are defined.</span>

<span class="sd">    ``plot_model(node_supports=False)`` - plot the model without the supports.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># az_el - azimut, elevation used for 3d plots only</span>
    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_model_2d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span>
                            <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span>
                            <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span> <span class="n">fmt_model</span><span class="p">,</span>
                            <span class="n">fmt_model_nodes_only</span><span class="p">,</span> <span class="n">node_supports</span><span class="p">,</span>
                            <span class="n">gauss_points</span><span class="p">,</span> <span class="n">fmt_gauss_points</span><span class="p">,</span>
                            <span class="n">fmt_model_truss</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis_off</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_model_3d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span>
                            <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span> <span class="n">az_el</span><span class="p">,</span>
                            <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">local_axes</span><span class="p">,</span>
                            <span class="n">nodes_only</span><span class="p">,</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">node_supports</span><span class="p">,</span>
                            <span class="n">gauss_points</span><span class="p">,</span> <span class="n">fmt_gauss_points</span><span class="p">,</span>
                            <span class="n">fmt_model_truss</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis_off</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="c1"># plt.show()  # call this from main py file for more control</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">def</span> <span class="nf">plot_supports_and_loads_2d</span><span class="p">(</span><span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is removed. Use plot_model() and</span>
<span class="sd">    plot_loads_2d() for showing support conditions and loads,</span>
<span class="sd">    respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! plot_supports_and_loads_2d has been removed.&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Use plot_model(node_supports=True) for showing supports and&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! plot_loads_2d() for showing loads&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>


<span class="k">def</span> <span class="nf">plot_loads_2d</span><span class="p">(</span><span class="n">nep</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">fmt_model_loads</span><span class="p">,</span>
                  <span class="n">node_supports</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the nodal and element loads applied to the 2d models.</span>
<span class="sd">    This is a local function: use plot_load()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_wi_he</span><span class="p">:</span>
            <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fig_lbrt</span><span class="p">:</span>
            <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">fleft</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fbottom</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">fright</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ftop</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_model</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_labels</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmt_model</span><span class="o">=</span><span class="n">fmt_model_loads</span><span class="p">,</span>
                    <span class="n">node_supports</span><span class="o">=</span><span class="n">node_supports</span><span class="p">,</span>
                    <span class="n">truss_node_offset</span><span class="o">=</span><span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># ax.axis(&#39;equal&#39;)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xsfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">)</span>
        <span class="n">ysfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span><span class="p">)</span>
        <span class="n">sfac</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xsfac</span><span class="p">,</span> <span class="n">ysfac</span><span class="p">)</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">Wx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">waa</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">wab</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">### get Ew data</span>
    <span class="n">Ew</span> <span class="o">=</span> <span class="n">get_Ew_data_from_ops_domain</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>

        <span class="n">ele_class_tag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam2d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn2d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn2d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TimoshenkoBeamColumn2d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticTimoshenkoBeam2d</span><span class="p">):</span>

            <span class="c1"># by default no element load</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">Ew</span><span class="p">:</span>
                <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">Ew</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ecrd_eles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ecrd_nodes</span><span class="p">)</span>

            <span class="n">ele_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;offsets&#39;</span><span class="p">))</span>
            <span class="n">nz_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ele_offsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># tuple of arrays</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nz_offsets</span><span class="p">):</span>
                <span class="c1"># modify ecrd_eles</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># step 1: first plot model itself</span>
            <span class="c1"># ax.plot(ecrd[:, 0], ecrd[:, 1], &#39;k-&#39;, solid_capstyle=&#39;round&#39;, solid_joinstyle=&#39;round&#39;,</span>
            <span class="c1">#         dash_capstyle=&#39;butt&#39;, dash_joinstyle=&#39;round&#39;)</span>

            <span class="c1"># step 2</span>
            <span class="n">Lxy</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>
            <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">Lxy</span> <span class="o">/</span> <span class="n">L</span>

            <span class="c1"># if not sfac:</span>
            <span class="c1">#     sfac = ratio * L</span>

            <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
            <span class="n">xl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="c1"># xl2 = np.logspace(0., 1., nep) * L / nep</span>
            <span class="n">dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
            <span class="c1"># dxs = np.array([0.15, 0.2, 0.275, 0.375])</span>
            <span class="n">xl3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dxs</span><span class="p">))</span> <span class="o">*</span> <span class="n">L</span>

            <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>
            <span class="c1"># pl = ops.eleResponse(ele_tag, &#39;localForces&#39;)</span>

            <span class="c1"># s_all, xl, nep = section_force_distribution_2d(ex, ey, pl, nep, ele_load_data)</span>

            <span class="k">for</span> <span class="n">ele_load_data_i</span> <span class="ow">in</span> <span class="n">ele_load_data</span><span class="p">:</span>
                <span class="n">ele_load_type</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamPoint&#39;</span><span class="p">:</span>
                    <span class="n">Pt</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Pa</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">aL</span> <span class="o">*</span> <span class="n">L</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Pt</span><span class="p">)</span>

                    <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="c1"># s_0 = [ecrd[0, 0], ecrd[0, 1]]</span>

                    <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cosa</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cosb</span>

                    <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

                    <span class="n">s_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosb</span>
                    <span class="n">s_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosa</span>


                    <span class="c1"># plot arrows</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">s_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="c1"># width = 0.01,</span>
                             <span class="n">head_starts_at_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># default False</span>
                             <span class="c1"># overhang=0.2,</span>
                             <span class="c1"># lw = 1,</span>
                             <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sfac</span><span class="p">,</span>
                             <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                             <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">Pt</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                    <span class="c1"># ax.annotate(&quot;&quot;, xy=(s_p[0], s_p[1]),</span>
                    <span class="c1">#             xytext=(s_0[0], s_0[1]),</span>
                    <span class="c1">#             arrowprops=dict(arrowstyle=&quot;-&gt;&quot;, color=&#39;r&#39;, lw=3,</span>
                    <span class="c1">#                             connectionstyle=&quot;arc3&quot;))</span>

                <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamUniform&#39;</span><span class="p">:</span>

                    <span class="n">n_ele_load_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_load_data_i</span><span class="p">)</span>

                    <span class="c1"># constant uniform element load</span>
                    <span class="k">if</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="c1"># eload_type, Wy, Wx = ele_load_data[0], ele_load_data[1], ele_load_data[2]</span>
                        <span class="n">Wy</span><span class="p">,</span> <span class="n">Wx</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">Wy</span><span class="p">)</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">Wx</span><span class="p">)</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="s1">&#39;</span>

                        <span class="c1"># s = sfac * Wy * one</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">one</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Wy</span><span class="p">)</span>
                        <span class="c1"># plt.text(sum(ecrd[:, 0])/2, sum(ecrd[:, 1])/2, f&#39;q = {Wy}, {Wx}&#39;, va=&#39;bottom&#39;, ha=&#39;center&#39;, color=&#39;r&#39;)</span>

                    <span class="c1"># triangular or trapezoidal element load</span>
                    <span class="k">elif</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
                        <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">wta</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">waa</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">aL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">bL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">wtb</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">wab</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">aL</span> <span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="n">bL</span> <span class="o">*</span> <span class="n">L</span>
                        <span class="n">bma</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>

                        <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">xl</span><span class="p">):</span>
                            <span class="n">xma</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span>
                            <span class="n">wtx</span> <span class="o">=</span> <span class="n">wta</span> <span class="o">+</span> <span class="p">(</span><span class="n">wtb</span> <span class="o">-</span> <span class="n">wta</span><span class="p">)</span> <span class="o">*</span> <span class="n">xma</span> <span class="o">/</span> <span class="n">bma</span>

                            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                                <span class="k">pass</span>
                            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
                                <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtx</span>
                            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                                <span class="k">pass</span>

                            <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sfac</span>

                    <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># s_0[0, :] = [ex[0], ey[0]]</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>

                    <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosa</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosb</span>

                    <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

                    <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosb</span>
                    <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosa</span>
                    <span class="c1"># plt.axis(&#39;equal&#39;)</span>

                    <span class="c1"># reference perpendicular lines</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="c1"># width = 0.005,</span>
                                 <span class="c1"># lw = 2,</span>
                                 <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span>
                                 <span class="n">head_starts_at_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># default False</span>
                                 <span class="c1"># overhang=0.5,</span>
                                 <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                                 <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                        <span class="c1"># ax.annotate(&quot;&quot;, xy=(s_p[i, 0], s_p[i, 1]),</span>
                        <span class="c1">#             xytext=(s_0[i, 0], s_0[i, 1]),</span>
                        <span class="c1">#             arrowprops=dict(arrowstyle=&quot;-&gt;&quot;, color=&#39;r&#39;, lw=1,</span>
                        <span class="c1">#                             connectionstyle=&quot;arc3&quot;))</span>

                    <span class="c1"># connecting beg-end line - redundant ?</span>
                    <span class="c1"># plt.plot([s_p[0, 0], s_p[-1, 0]],[s_p[0, 1], s_p[-1, 1]], &#39;r&#39;)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">text_string</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">Wx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># for i, xl in enumerate(xl2[:-1]):</span>
                        <span class="c1">#     plt.arrow(sa[i, 0], sa[i, 1],</span>
                        <span class="c1">#               sa[i+1, 0]-sa[i, 0], sa[i+1, 1]-sa[i, 1],</span>
                        <span class="c1">#               width = 0.01,</span>
                        <span class="c1">#               # lw = 1,</span>
                        <span class="c1">#               # head_width=0.02, head_length=0.05,</span>
                        <span class="c1">#               # head_starts_at_zero=True,  # default False</span>
                        <span class="c1">#               # overhang=0.5,</span>
                        <span class="c1">#               fc=&#39;m&#39;, ec=&#39;m&#39;,</span>
                        <span class="c1">#               length_includes_head=True, shape=&#39;full&#39;)</span>

                        <span class="k">if</span> <span class="n">Wx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
                                      <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                                      <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                      <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">waa</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">wab</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="c1"># sa[0, :] = [ex[0], ey[0]]</span>
                        <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
                        <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosa</span>
                        <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosb</span>

                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xl3</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                     <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                     <span class="c1"># width = 0.05,</span>
                                     <span class="n">width</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>
                                     <span class="c1"># lw = 1,</span>
                                     <span class="c1"># head_width=0.02, head_length=0.05,</span>
                                     <span class="c1"># head_starts_at_zero=True,  # default False</span>
                                     <span class="c1"># overhang=0.5,</span>
                                     <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span>
                                     <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>

                        <span class="c1"># ax.quiver(sa[:-1, 0], sa[:-1, 1],</span>
                        <span class="c1">#            sa[1:, 0]-sa[:-1, 0], sa[1:, 1]-sa[:-1, 1],</span>
                        <span class="c1">#            scale_units=&#39;xy&#39;, angles=&#39;xy&#39;, scale=0.8, color=&#39;g&#39;)</span>

                        <span class="c1"># ax.plot([s_0[i, 0], s_p[i, 0]], [s_0[i, 1], s_p[i, 1]],</span>
                        <span class="c1">#          fmt_secforce, solid_capstyle=&#39;round&#39;,</span>
                        <span class="c1">#          solid_joinstyle=&#39;round&#39;, dash_capstyle=&#39;butt&#39;,</span>
                        <span class="c1">#          dash_joinstyle=&#39;round&#39;)</span>
                        <span class="c1"># plot arrows</span>
                        <span class="c1"># ax.annotate(&quot;&quot;,</span>
                        <span class="c1">#              xy=(s_p[i, 0], s_p[i, 1]), xycoords=&#39;data&#39;,</span>
                        <span class="c1">#              xytext=(s_0[i, 0], s_0[i, 1]), textcoords=&#39;data&#39;,</span>
                        <span class="c1">#              arrowprops=dict(arrowstyle=&quot;-&gt;&quot;, color=&#39;r&#39;, lw=2,</span>
                        <span class="c1">#                              connectionstyle=&quot;arc3&quot;))</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">nd_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="c1"># 2. nodal loads 2d</span>
        <span class="n">nodal_loads</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeUnbalance</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>
        <span class="n">nodal_loads_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kier</span> <span class="ow">in</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># horizontal or vertical nodal force (load)</span>
                <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span>
                             <span class="c1"># width = 0.01,</span>
                             <span class="c1"># head_starts_at_zero=True,  # default False</span>
                             <span class="c1"># overhang=0.2,</span>
                             <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span>
                             <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                             <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span><span class="si">:</span><span class="s1">.5g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

                <span class="c1"># concentrated bending moment</span>
                <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;anti-clockwise&#39;</span>
                        <span class="c1"># marker_type=r&#39;$\circlearrowleft$&#39;</span>
                        <span class="n">marker_type</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\curvearrowleft$&#39;</span>
                    <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;clockwise&#39;</span>
                        <span class="c1"># marker_type=r&#39;$\circlearrowright$&#39;</span>
                        <span class="n">marker_type</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\curvearrowright$&#39;</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker_type</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span><span class="si">:</span><span class="s1">.5g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">plot_loads_3d</span><span class="p">(</span><span class="n">nep</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">fmt_model_loads</span><span class="p">,</span>
                  <span class="n">node_supports</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">local_axes</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the nodal and element loads applied to the 3d models.</span>
<span class="sd">    This is a local function: use plot_load()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_wi_he</span><span class="p">:</span>
            <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">))</span>
            <span class="c1"># fig.subplots_adjust(left=.08, bottom=.08, right=.985, top=.94)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fig_lbrt</span><span class="p">:</span>
            <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">fleft</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fbottom</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">fright</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ftop</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_model</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_labels</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmt_model</span><span class="o">=</span><span class="n">fmt_model_loads</span><span class="p">,</span>
                    <span class="n">node_supports</span><span class="o">=</span><span class="n">node_supports</span><span class="p">,</span> <span class="n">local_axes</span><span class="o">=</span><span class="n">local_axes</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># initial scale 10% of the max dimension</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">min_z</span><span class="p">,</span> <span class="n">max_z</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()</span>
        <span class="n">xsfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">)</span>
        <span class="n">ysfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span><span class="p">)</span>
        <span class="n">zsfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_z</span> <span class="o">-</span> <span class="n">min_z</span><span class="p">)</span>
        <span class="n">sfac</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xsfac</span><span class="p">,</span> <span class="n">ysfac</span><span class="p">,</span> <span class="n">zsfac</span><span class="p">)</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="c1"># ndf = ops.getNDF()[0]</span>

    <span class="n">Wx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">waa</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">wab</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">Ew</span> <span class="o">=</span> <span class="n">get_Ew_data_from_ops_domain_3d</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>  <span class="c1"># plot load 3d</span>

        <span class="n">ele_class_tag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam3d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn3d</span>
            <span class="ow">or</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn3d</span><span class="p">):</span>

            <span class="c1"># by default no element load</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">Ew</span><span class="p">:</span>
                <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">Ew</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="n">ecrd_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ecrd_eles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ecrd_nodes</span><span class="p">)</span>

            <span class="n">ele_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;offsets&#39;</span><span class="p">))</span>
            <span class="n">nz_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ele_offsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># tuple of arrays</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nz_offsets</span><span class="p">):</span>  <span class="c1"># plot load 3d</span>
                <span class="c1"># modify ecrd_eles</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
                <span class="n">ecrd_eles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ele_offsets</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># step 2</span>
            <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
            <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
            <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>

            <span class="n">G</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ecrd_eles</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

            <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
            <span class="n">xl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="c1"># xl2 = np.logspace(0., 1., nep) * L / nep</span>
            <span class="n">dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
            <span class="c1"># dxs = np.array([0.15, 0.2, 0.275, 0.375])</span>
            <span class="n">xl3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dxs</span><span class="p">))</span> <span class="o">*</span> <span class="n">L</span>

            <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ele_load_data_i</span> <span class="ow">in</span> <span class="n">ele_load_data</span><span class="p">:</span>  <span class="c1"># plot load 3d</span>
                <span class="n">ele_load_type</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># fixme uncomment when regular uniformLoad works! (1)</span>
                <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamPoint&#39;</span><span class="p">:</span>  <span class="c1"># plot load 3d</span>
                    <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Px</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
                    <span class="n">Pxyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">]</span>
                    <span class="n">xa</span> <span class="o">=</span> <span class="n">aL</span> <span class="o">*</span> <span class="n">L</span>
                    <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pyzx:</span><span class="si">{</span><span class="n">Py</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">Pz</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">Px</span><span class="si">}</span><span class="s1">&#39;</span>

                    <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xa</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xa</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">s_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xa</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">Pi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Pxyz</span><span class="p">):</span>

                        <span class="k">if</span> <span class="n">Pi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">dir_plt</span> <span class="o">=</span> <span class="n">k</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Pi</span><span class="p">)</span>

                            <span class="n">dx</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                            <span class="n">dy</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="n">dz</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                            <span class="c1"># plot arrows: 3d beamPoint</span>
                            <span class="n">nn</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># additional scaling for arrows</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">arrow3D</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">nn</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span>
                                       <span class="n">nn</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span>
                                       <span class="n">nn</span> <span class="o">*</span> <span class="n">dz</span><span class="p">,</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                       <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="p">,</span>
                                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">Pi</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamUniform&#39;</span><span class="p">:</span>  <span class="c1"># plot load 3d</span>

                    <span class="n">n_ele_load_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_load_data_i</span><span class="p">)</span>

                    <span class="c1"># constant uniform element load</span>
                    <span class="k">if</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="c1"># eload_type, Wy, Wx = ele_load_data[0], ele_load_data[1], ele_load_data[2]</span>
                        <span class="n">Wy</span><span class="p">,</span> <span class="n">Wz</span><span class="p">,</span> <span class="n">Wx</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="n">Wy</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">Wz</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">Wx</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="n">Wxyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">Wx</span><span class="p">,</span> <span class="n">Wy</span><span class="p">,</span> <span class="n">Wz</span><span class="p">]</span>

                        <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                        <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

                        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">Wi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Wxyz</span><span class="p">):</span>

                            <span class="k">if</span> <span class="n">Wi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                                <span class="n">dir_plt</span> <span class="o">=</span> <span class="n">k</span>
                                <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">one</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Wi</span><span class="p">)</span>  <span class="c1"># fixme: 2d is different</span>

                                <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

                                <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                                <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">nn</span> <span class="o">=</span> <span class="mf">0.3</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">nn</span> <span class="o">=</span> <span class="mi">1</span>

                                <span class="c1"># plot arrows 3D beamUniform</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow3D</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                               <span class="n">nn</span> <span class="o">*</span> <span class="p">(</span><span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
                                               <span class="n">nn</span> <span class="o">*</span> <span class="p">(</span><span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                                               <span class="n">nn</span> <span class="o">*</span> <span class="p">(</span><span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

                                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s_p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">Wi</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                    <span class="c1"># triangular or trapezoidal element load</span>
                    <span class="k">elif</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
                        <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="n">wta</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">waa</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">aL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">bL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">wtb</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">wab</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">aL</span> <span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="n">bL</span> <span class="o">*</span> <span class="n">L</span>
                        <span class="n">bma</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>

                        <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">xl</span><span class="p">):</span>
                            <span class="n">xma</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span>
                            <span class="n">wtx</span> <span class="o">=</span> <span class="n">wta</span> <span class="o">+</span> <span class="p">(</span><span class="n">wtb</span> <span class="o">-</span> <span class="n">wta</span><span class="p">)</span> <span class="o">*</span> <span class="n">xma</span> <span class="o">/</span> <span class="n">bma</span>

                            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                                <span class="k">pass</span>
                            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
                                <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtx</span>
                            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                                <span class="k">pass</span>

                            <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">nd_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="n">nodal_loads</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeUnbalance</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>  <span class="c1"># plot load 3d</span>
        <span class="n">nodal_loads_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kier</span> <span class="ow">in</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>

                <span class="c1"># horizontal or vertical nodal force (load)</span>
                <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">kolor</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                    <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dz</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">kolor</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
                    <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dz</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                <span class="n">nn</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># additional scaling for arrows</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">arrow3D</span><span class="p">(</span><span class="o">*</span><span class="n">nd_crd</span><span class="p">,</span>
                           <span class="n">nn</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span>
                           <span class="n">nn</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span>
                           <span class="n">nn</span> <span class="o">*</span> <span class="n">dz</span><span class="p">,</span>
                           <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">kolor</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">kolor</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">nn</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># additional scaling for arrows</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow3D</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span>
                               <span class="n">nn</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span>
                               <span class="n">nn</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span>
                               <span class="n">nn</span> <span class="o">*</span> <span class="n">dz</span><span class="p">,</span>
                               <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">kolor</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">kolor</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<div class="viewcode-block" id="plot_load">
<a class="viewcode-back" href="../../plot_load.html#opsvis.plot_load">[docs]</a>
<span class="k">def</span> <span class="nf">plot_load</span><span class="p">(</span><span class="n">nep</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">fig_lbrt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt_model_loads</span><span class="o">=</span><span class="n">fmt_model_loads</span><span class="p">,</span>
              <span class="n">node_supports</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">local_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the nodal and element loads applied to the 2d and 3d models.</span>

<span class="sd">    Args:</span>
<span class="sd">        nep (int): number of arrows when displacing element distributed loads</span>
<span class="sd">            (default: 11)</span>

<span class="sd">        node_supports (bool): True - show the node support conditions.</span>
<span class="sd">            Default: False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_loads_2d</span><span class="p">(</span><span class="n">nep</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span>
                           <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">fmt_model_loads</span><span class="p">,</span>
                           <span class="n">node_supports</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_loads_3d</span><span class="p">(</span><span class="n">nep</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span>
                           <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">fmt_model_loads</span><span class="p">,</span>
                           <span class="n">node_supports</span><span class="p">,</span> <span class="n">truss_node_offset</span><span class="p">,</span>
                           <span class="n">local_axes</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="c1"># elif ndim == 1:</span>
    <span class="c1">#     ax = plot_loads_1d()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">def</span> <span class="nf">get_nodal_loads_from_ops_domain</span><span class="p">():</span>
    <span class="n">load_at_nodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ibeg</span><span class="p">,</span> <span class="n">iend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">node_load_tags_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeLoadTags</span><span class="p">()</span>
    <span class="n">node_load_data_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeLoadData</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">node_load_tag</span> <span class="ow">in</span> <span class="n">node_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">load_at_nodes</span><span class="p">[</span><span class="n">node_load_tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node_load_tag</span> <span class="ow">in</span> <span class="n">node_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">ndf</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDF</span><span class="p">(</span><span class="n">node_load_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">ndf</span>
        <span class="n">node_load_data</span> <span class="o">=</span> <span class="n">node_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
        <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
        <span class="n">load_at_nodes</span><span class="p">[</span><span class="n">node_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_load_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">load_at_nodes</span>


<span class="k">def</span> <span class="nf">get_Ew_data_from_ops_domain</span><span class="p">():</span>

    <span class="n">Ew</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ibeg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ele_load_tags_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadTags</span><span class="p">()</span>
    <span class="n">ele_load_types_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadClassTags</span><span class="p">()</span>
    <span class="n">ele_load_data_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadData</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="n">ele_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># iterate over ele_load_tags/classtags</span>
    <span class="k">for</span> <span class="n">ele_load_type</span><span class="p">,</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ele_load_types_all_patterns</span><span class="p">,</span>
                                           <span class="n">ele_load_tags_all_patterns</span><span class="p">):</span>

        <span class="c1"># -beamUniform</span>
        <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wy</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wx</span><span class="p">])</span>
        <span class="c1"># -beamUniform partial</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPartialUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPartialUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wta</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">wab</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span><span class="p">])</span>
        <span class="c1"># -beamPoint</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPointLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPointLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">Pt</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">aL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamPoint&#39;</span><span class="p">,</span> <span class="n">Pt</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Pa</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ele_load_type:</span><span class="se">\n</span><span class="si">{</span><span class="n">ele_load_type</span><span class="si">}</span><span class="s1"> - Unknown element load Error&#39;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">Ew</span>


<span class="k">def</span> <span class="nf">get_Ew_data_from_ops_domain_3d</span><span class="p">():</span>

    <span class="n">Ew</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ibeg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ele_load_tags_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadTags</span><span class="p">()</span>
    <span class="n">ele_load_types_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadClassTags</span><span class="p">()</span>
    <span class="n">ele_load_data_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadData</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="n">ele_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># iterate over ele_load_tags/classtags</span>
    <span class="k">for</span> <span class="n">ele_load_type</span><span class="p">,</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ele_load_types_all_patterns</span><span class="p">,</span>
                                           <span class="n">ele_load_tags_all_patterns</span><span class="p">):</span>

        <span class="c1"># -beamUniform</span>
        <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">wx</span><span class="p">])</span>
        <span class="c1"># -beamUniform partial</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dPartialUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dPartialUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">])</span>
        <span class="c1"># -beamPoint</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dPointLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam3dPointLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span> <span class="n">aL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamPoint&#39;</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Px</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ele_load_type:</span><span class="se">\n</span><span class="si">{</span><span class="n">ele_load_type</span><span class="si">}</span><span class="s1"> - Unknown element load Error&#39;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">Ew</span>


<div class="viewcode-block" id="plot_extruded_shapes_3d">
<a class="viewcode-back" href="../../plot_extruded_model_rect_section_3d.html#opsvis.plot_extruded_shapes_3d">[docs]</a>
<span class="k">def</span> <span class="nf">plot_extruded_shapes_3d</span><span class="p">(</span><span class="n">ele_shapes</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span>
                            <span class="n">fig_wi_he</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">fig_lbrt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot an extruded 3d model based on cross-section dimenions.</span>

<span class="sd">    Three arrows present local section axes: green - local x-axis,</span>
<span class="sd">    red - local z-axis, blue - local y-axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        ele_shapes (dict): keys are ele_tags and values are lists of:</span>
<span class="sd">            shape_type (str): &#39;rect&#39; - rectangular shape, &#39;I&#39; - double T shape</span>
<span class="sd">            and shape_args (list): list of floats, which necessary section</span>
<span class="sd">            dimensions.</span>
<span class="sd">            For &#39;rect&#39; the list is [b d]; width and depth,</span>
<span class="sd">            for &#39;I&#39; shape - [bf d tw tf]; flange width, section depth, web</span>
<span class="sd">            and flange thicknesses</span>
<span class="sd">            Example: ele_shapes = {1: [&#39;rect&#39;, [b, d]],</span>
<span class="sd">            2: [&#39;I&#39;, [bf, d, tw, tf]]}</span>

<span class="sd">        az_el (tuple): azimuth and elevation</span>

<span class="sd">        fig_wi_he: figure width and height in centimeters</span>

<span class="sd">        fig_lbrt: figure left, bottom, right, top boundaries</span>

<span class="sd">    Usage:</span>
<span class="sd">        ::</span>

<span class="sd">            ele_shapes = {1: [&#39;circ&#39;, [b]],</span>
<span class="sd">                          2: [&#39;rect&#39;, [b, h]],</span>
<span class="sd">                          3: [&#39;I&#39;, [b, h, b/10., h/6.]]}</span>
<span class="sd">            opsv.plot_extruded_shapes_3d(ele_shapes)</span>

<span class="sd">    Notes:</span>

<span class="sd">    - For now only rectangular, circular and double T sections are supported.</span>

<span class="sd">    - This function can be a source of inconsistency because OpenSees lacks</span>
<span class="sd">      functions to return section dimensions. A workaround is to have own</span>
<span class="sd">      Python helper functions to reuse data specified once</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_wi_he</span><span class="p">:</span>
            <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">))</span>
            <span class="c1"># fig.subplots_adjust(left=.08, bottom=.08, right=.985, top=.94)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fig_lbrt</span><span class="p">:</span>
            <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">fleft</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fbottom</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">fright</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ftop</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

        <span class="c1"># mesh outline</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span>
                <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># eo = Eo[i, :]</span>
        <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
        <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
        <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>

        <span class="n">G</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

        <span class="c1"># by default empty</span>
        <span class="n">shape_type</span><span class="p">,</span> <span class="n">shape_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;circ&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_shapes</span><span class="p">:</span>
            <span class="n">shape_type</span><span class="p">,</span> <span class="n">shape_args</span> <span class="o">=</span> <span class="n">ele_shapes</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_rect</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                      <span class="n">shape_args</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_double_T</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                          <span class="n">shape_args</span><span class="p">)</span>

            <span class="c1"># plot 3d sides</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">Poly3DCollection</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                                                 <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_circ</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                    <span class="n">shape_args</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">)</span>

        <span class="c1"># common for all members</span>
        <span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">alen</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">L</span>

        <span class="c1"># plot local axis directional vectors: workaround quiver = arrow</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                  <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                  <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                  <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_zlim3d</span><span class="p">())))</span></div>



<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_double_T</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">bf</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">shape_args</span>

    <span class="n">za</span><span class="p">,</span> <span class="n">zb</span> <span class="o">=</span> <span class="n">tw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bf</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">ya</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">tf</span><span class="p">,</span> <span class="n">d</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">g10a</span><span class="p">,</span> <span class="n">g11a</span><span class="p">,</span> <span class="n">g12a</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ya</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ya</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ya</span>
    <span class="n">g10b</span><span class="p">,</span> <span class="n">g11b</span><span class="p">,</span> <span class="n">g12b</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">yb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">yb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">yb</span>

    <span class="n">g20a</span><span class="p">,</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">g22a</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">za</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">za</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">za</span>
    <span class="n">g20b</span><span class="p">,</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">g22b</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">zb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">zb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">zb</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># beg node (I) cross-section vertices crds, counter-clockwise order</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="c1"># end node (J) cross-section vertices</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="c1"># list of sides</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
              <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]],</span>  <span class="c1"># beg</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span>
              <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]],</span>  <span class="c1"># end</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]],</span>  <span class="c1"># bot 1</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span>  <span class="c1"># top 2</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">]],</span>  <span class="c1"># 3</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]],</span>  <span class="c1"># 4</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]],</span>  <span class="c1"># 5</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">]],</span>  <span class="c1"># 6</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]],</span>  <span class="c1"># 7</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">]],</span>  <span class="c1"># 8</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">]],</span>  <span class="c1"># 9</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]],</span>  <span class="c1"># 10</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]],</span>  <span class="c1"># 11</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">]]]</span>  <span class="c1"># 12</span>

    <span class="k">return</span> <span class="n">verts</span>


<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_rect</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">shape_args</span>
    <span class="n">b2</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">g10</span><span class="p">,</span> <span class="n">g11</span><span class="p">,</span> <span class="n">g12</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">d2</span>
    <span class="n">g20</span><span class="p">,</span> <span class="n">g21</span><span class="p">,</span> <span class="n">g22</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">b2</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># beg node cross-section vertices</span>
    <span class="c1"># collected i-beg, j-end node coordinates, counter-clockwise order</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="c1"># end node cross-section vertices</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>

    <span class="c1"># list of 4-node sides</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>  <span class="c1"># beg</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>  <span class="c1"># end</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>  <span class="c1"># bottom</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>  <span class="c1"># top</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>  <span class="c1"># front</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>  <span class="c1"># back</span>

    <span class="k">return</span> <span class="n">verts</span>


<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_circ</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">shape_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># subdivde member length</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># subdivide circle</span>

    <span class="n">xl</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span>


<span class="k">def</span> <span class="nf">bar_length</span><span class="p">(</span><span class="n">ecrd</span><span class="p">):</span>
    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">L</span>


<span class="k">def</span> <span class="nf">rot_transf_2d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">):</span>

    <span class="n">Lxy</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>
    <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">Lxy</span> <span class="o">/</span> <span class="n">L</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">cosb</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">cosb</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span>


<span class="k">def</span> <span class="nf">rot_transf_3d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([[</span><span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Seweryn Kokot.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>