<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>opsvis &mdash; opsvis 0.94.9 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> opsvis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plot_model.html">plot_model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_defo.html">plot_defo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_supports_and_loads_2d.html">plot_supports_and_loads_2d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_mode_shape.html">plot_mode_shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section_force_diagram_2d.html">section_force_diagram_2d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section_force_diagram_3d.html">section_force_diagram_3d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_stress_2d.html">plot_stress_2d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_extruded_model_rect_section_3d.html">plot_extruded_model_rect_section_3d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anim_defo.html">anim_defo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anim_mode.html">anim_mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_fiber_section.html">plot_fiber_section</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fib_sec_list_to_cmds.html">fib_sec_list_to_cmds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sig_out_per_node.html">sig_out_per_node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">opsvis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>opsvis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for opsvis</h1><div class="highlight"><pre>
<span></span><span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>

<span class="c1"># plot_fiber_section is inspired by plotSection matlab function</span>
<span class="c1"># written by D. Vamvatsikos available at</span>
<span class="c1"># http://users.ntua.gr/divamva/software.html (plotSection.zip)</span>


<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="plot_fiber_section"><a class="viewcode-back" href="../plot_fiber_section.html#opsvis.plot_fiber_section">[docs]</a><span class="k">def</span> <span class="nf">plot_fiber_section</span><span class="p">(</span><span class="n">fib_sec_list</span><span class="p">,</span> <span class="n">fillflag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">matcolor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Plot fiber cross-section.</span>

<span class="sd">    Args:</span>
<span class="sd">        fib_sec_list (list): list of lists in the format similar to the parameters</span>
<span class="sd">            for the section, layer, patch, fiber OpenSees commands</span>

<span class="sd">        fillflag (int): 1 - filled fibers with color specified in matcolor</span>
<span class="sd">            list, 0 - no color, only the outline of fibers</span>

<span class="sd">        matcolor (list): sequence of colors for various material tags</span>
<span class="sd">            assigned to fibers</span>

<span class="sd">    Examples:</span>
<span class="sd">        ::</span>

<span class="sd">            fib_sec_1 = [[&#39;section&#39;, &#39;Fiber&#39;, 1, &#39;-GJ&#39;, 1.0e6],</span>
<span class="sd">                         [&#39;patch&#39;, &#39;quad&#39;, 1, 4, 1,  0.032, 0.317, -0.311, 0.067, -0.266, 0.005, 0.077, 0.254],  # noqa: E501</span>
<span class="sd">                         [&#39;patch&#39;, &#39;quad&#39;, 1, 1, 4,  -0.075, 0.144, -0.114, 0.116, 0.075, -0.144, 0.114, -0.116],  # noqa: E501</span>
<span class="sd">                         [&#39;patch&#39;, &#39;quad&#39;, 1, 4, 1,  0.266, -0.005,  -0.077, -0.254,  -0.032, -0.317,  0.311, -0.067]  # noqa: E501</span>
<span class="sd">                         ]</span>
<span class="sd">            opsv.fib_sec_list_to_cmds(fib_sec_1)</span>
<span class="sd">            matcolor = [&#39;r&#39;, &#39;lightgrey&#39;, &#39;gold&#39;, &#39;w&#39;, &#39;w&#39;, &#39;w&#39;]</span>
<span class="sd">            opsv.plot_fiber_section(fib_sec_1, matcolor=matcolor)</span>
<span class="sd">            plt.axis(&#39;equal&#39;)</span>
<span class="sd">            # plt.savefig(&#39;fibsec_rc.png&#39;)</span>
<span class="sd">            plt.show()</span>

<span class="sd">    Notes:</span>
<span class="sd">        ``fib_sec_list`` can be reused by means of a python helper function</span>
<span class="sd">            ``opsvis.fib_sec_list_to_cmds(fib_sec_list_1)``</span>

<span class="sd">    See also:</span>
<span class="sd">        ``opsvis.fib_sec_list_to_cmds()``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fib_sec_list</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;layer&#39;</span><span class="p">:</span>
            <span class="n">matTag</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;straight&#39;</span><span class="p">:</span>
                <span class="n">n_bars</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">As</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iy</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">n_bars</span><span class="p">)</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iz</span><span class="p">,</span> <span class="n">Jz</span><span class="p">,</span> <span class="n">n_bars</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
                    <span class="n">bar</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="n">zi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">r</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
                <span class="n">n_bars</span><span class="p">,</span> <span class="n">As</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">yC</span><span class="p">,</span> <span class="n">zC</span><span class="p">,</span> <span class="n">arc_radius</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">a0_deg</span><span class="p">,</span> <span class="n">a1_deg</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a0_deg</span><span class="p">,</span> <span class="n">a1_deg</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">360.</span> <span class="o">-</span> <span class="mf">360.</span><span class="o">/</span><span class="n">n_bars</span>

                <span class="n">a0_rad</span><span class="p">,</span> <span class="n">a1_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a0_deg</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a1_deg</span> <span class="o">/</span> <span class="mf">180.</span>
                <span class="n">r_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a0_rad</span><span class="p">,</span> <span class="n">a1_rad</span><span class="p">,</span> <span class="n">n_bars</span><span class="p">)</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">yC</span> <span class="o">+</span> <span class="n">arc_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">zC</span> <span class="o">+</span> <span class="n">arc_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
                    <span class="n">bar</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="n">zi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">r_bar</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quad&#39;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadr&#39;</span> <span class="ow">or</span>
                                  <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">)):</span>
            <span class="n">matTag</span><span class="p">,</span> <span class="n">nIJ</span><span class="p">,</span> <span class="n">nJK</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quad&#39;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadr&#39;</span><span class="p">:</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">Lz</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">:</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">Lz</span> <span class="o">=</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Kz</span>

            <span class="c1"># check for convexity (vector products)</span>
            <span class="n">outIJxIK</span> <span class="o">=</span> <span class="p">(</span><span class="n">Jy</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Kz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ky</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Jz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span>
            <span class="n">outIKxIL</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ky</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Lz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ly</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Kz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span>
            <span class="c1"># check if I, J, L points are colinear</span>
            <span class="n">outIJxIL</span> <span class="o">=</span> <span class="p">(</span><span class="n">Jy</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Lz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ly</span><span class="o">-</span><span class="n">Iy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Jz</span><span class="o">-</span><span class="n">Iz</span><span class="p">)</span>
            <span class="c1"># outJKxJL = (Ky-Jy)*(Lz-Jz) - (Ly-Jy)*(Kz-Jz)</span>

            <span class="k">if</span> <span class="n">outIJxIK</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outIKxIL</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outIJxIL</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Patch quad is non-convex or counter-clockwise defined or has at least 3 colinear points in line&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>

            <span class="n">IJz</span><span class="p">,</span> <span class="n">IJy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iz</span><span class="p">,</span> <span class="n">Jz</span><span class="p">,</span> <span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iy</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">JKz</span><span class="p">,</span> <span class="n">JKy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Jz</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Jy</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">LKz</span><span class="p">,</span> <span class="n">LKy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Lz</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Ly</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ILz</span><span class="p">,</span> <span class="n">ILy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iz</span><span class="p">,</span> <span class="n">Lz</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Iy</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fillflag</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nIJ</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">IJz</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">LKz</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">IJy</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">LKy</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">nJK</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nIJ</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nJK</span><span class="p">):</span>
                        <span class="n">zy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]],</span>
                                       <span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span>
                                       <span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span>
                                       <span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]]])</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">zy</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">matcolor</span><span class="p">[</span><span class="n">matTag</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># horizontal lines</span>
                <span class="k">for</span> <span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">by</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">IJz</span><span class="p">,</span> <span class="n">LKz</span><span class="p">,</span> <span class="n">IJy</span><span class="p">,</span> <span class="n">LKy</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">],</span> <span class="p">[</span><span class="n">ay</span><span class="p">,</span> <span class="n">by</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># vertical lines</span>
                <span class="k">for</span> <span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">by</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">JKz</span><span class="p">,</span> <span class="n">ILz</span><span class="p">,</span> <span class="n">JKy</span><span class="p">,</span> <span class="n">ILy</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">],</span> <span class="p">[</span><span class="n">ay</span><span class="p">,</span> <span class="n">by</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
            <span class="n">matTag</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="n">yC</span><span class="p">,</span> <span class="n">zC</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">re</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>

            <span class="n">dr</span> <span class="o">=</span> <span class="p">(</span><span class="n">re</span> <span class="o">-</span> <span class="n">ri</span><span class="p">)</span> <span class="o">/</span> <span class="n">nr</span>
            <span class="n">dth</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a0</span><span class="p">)</span> <span class="o">/</span> <span class="n">nc</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                <span class="n">rj</span> <span class="o">=</span> <span class="n">ri</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dr</span>
                <span class="n">rj1</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">+</span> <span class="n">dr</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                    <span class="n">thi</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dth</span>
                    <span class="n">thi1</span> <span class="o">=</span> <span class="n">thi</span> <span class="o">+</span> <span class="n">dth</span>
                    <span class="n">wedge</span> <span class="o">=</span> <span class="n">Wedge</span><span class="p">((</span><span class="n">zC</span><span class="p">,</span> <span class="n">yC</span><span class="p">),</span> <span class="n">rj1</span><span class="p">,</span> <span class="n">thi</span><span class="p">,</span> <span class="n">thi1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">dr</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">matcolor</span><span class="p">[</span><span class="n">matTag</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">wedge</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="fib_sec_list_to_cmds"><a class="viewcode-back" href="../fib_sec_list_to_cmds.html#opsvis.fib_sec_list_to_cmds">[docs]</a><span class="k">def</span> <span class="nf">fib_sec_list_to_cmds</span><span class="p">(</span><span class="n">fib_sec_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reuses fib_sec_list to define fiber section in OpenSees.</span>

<span class="sd">    At present it is not possible to extract fiber section data from</span>
<span class="sd">    the OpenSees domain, this function is a workaround. The idea is to</span>
<span class="sd">    prepare data similar to the one the regular OpenSees commands</span>
<span class="sd">    (``section(&#39;Fiber&#39;, ...)``, ``fiber()``, ``patch()`` and/or</span>
<span class="sd">    ``layer()``) require.</span>

<span class="sd">    Args:</span>
<span class="sd">        fib_sec_list (list): is a list of fiber section data. First sub-list</span>
<span class="sd">        also defines the torsional stiffness (GJ).</span>

<span class="sd">    Warning:</span>

<span class="sd">    If you use this function, do not issue the regular OpenSees:</span>
<span class="sd">    section, Fiber, Patch or Layer commands.</span>

<span class="sd">    See also:</span>

<span class="sd">    ``opsvis.plot_fiber_section()``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">fib_sec_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="n">secTag</span><span class="p">,</span> <span class="n">GJ</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">ops</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;Fiber&#39;</span><span class="p">,</span> <span class="n">secTag</span><span class="p">,</span> <span class="s1">&#39;-GJ&#39;</span><span class="p">,</span> <span class="n">GJ</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;layer&#39;</span><span class="p">:</span>
            <span class="n">matTag</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;straight&#39;</span><span class="p">:</span>
                <span class="n">n_bars</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">As</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="s1">&#39;straight&#39;</span><span class="p">,</span> <span class="n">matTag</span><span class="p">,</span> <span class="n">n_bars</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;patch&#39;</span><span class="p">:</span>
            <span class="n">matTag</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">nIJ</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">nJK</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quad&#39;</span> <span class="ow">or</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadr&#39;</span><span class="p">:</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">Lz</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;quad&#39;</span><span class="p">,</span> <span class="n">matTag</span><span class="p">,</span> <span class="n">nIJ</span><span class="p">,</span> <span class="n">nJK</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span>
                          <span class="n">Ly</span><span class="p">,</span> <span class="n">Lz</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">:</span>
                <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">Jy</span><span class="p">,</span> <span class="n">Jz</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">Lz</span> <span class="o">=</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Kz</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="n">matTag</span><span class="p">,</span> <span class="n">nIJ</span><span class="p">,</span> <span class="n">nJK</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">)</span></div>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>

<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">stress_2d_ele_tags_only</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

    <span class="n">Stress2dEleClasstags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">,</span>
                                <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">,</span>
                                <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">,</span>
                                <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">,</span>
                                <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">])</span>

    <span class="n">ele_classtags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">()</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_classtags</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Stress2dEleClasstags</span><span class="p">]</span>

    <span class="n">ele_tags_2d_tris_quads_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ele_tags_2d_tris_quads_only</span>


<div class="viewcode-block" id="sig_out_per_node"><a class="viewcode-back" href="../sig_out_per_node.html#opsvis.sig_out_per_node">[docs]</a><span class="k">def</span> <span class="nf">sig_out_per_node</span><span class="p">(</span><span class="n">how_many</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a 2d numpy array of stress components per OpenSees node.</span>

<span class="sd">    Three first stress components (sxx, syy, sxy) are calculated and</span>
<span class="sd">    extracted from OpenSees, while the rest svm (Huber-Mieses-Hencky),</span>
<span class="sd">    two principal stresses (s1, s2) and directional angle are calculated</span>
<span class="sd">    as postprocessed quantities.</span>

<span class="sd">    Args:</span>
<span class="sd">        how_many (str): supported options are: &#39;all&#39; - all components,</span>
<span class="sd">            &#39;sxx&#39;, &#39;syy&#39;, &#39;sxy&#39;, &#39;svm&#39; (or &#39;vmis&#39;), &#39;s1&#39;, &#39;s2&#39;, &#39;angle&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sig_out (ndarray): a 2d array of stress components per node with</span>
<span class="sd">            the following components: sxx, syy, sxy, svm, s1, s2, angle.</span>
<span class="sd">            Size (n_nodes x 7).</span>

<span class="sd">    Examples:</span>
<span class="sd">        sig_out = opsv.sig_out_per_node()</span>

<span class="sd">    Notes:</span>
<span class="sd">       s1, s2: principal stresses</span>
<span class="sd">       angle: angle of the principal stress s1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_tags</span><span class="p">)</span>

    <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># initialize helper arrays</span>
    <span class="n">sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

    <span class="n">nodes_tag_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span>

    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nen</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">tmp_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

        <span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SSPquad</span><span class="p">:</span>
            <span class="n">sig_ip_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">)</span>
            <span class="c1"># sigM_nd = sigM_ip</span>
            <span class="n">sigM_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">sig_ip_el</span><span class="p">,</span> <span class="p">(</span><span class="n">nen</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig_nd_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stressAtNodes&#39;</span><span class="p">)</span>
            <span class="n">sigM_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sig_nd_el</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="c1"># sxx yy xy components</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">indxs</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># n_indxs &lt; n_nodes: e.g. 21&lt;25 (bous), 2&lt;6 (2el) etc.</span>
    <span class="n">n_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">indxs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># divide summed stresses by the number of common nodes</span>
    <span class="n">sig_out</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> \
        <span class="n">sig_out</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span><span class="o">/</span><span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_indxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;svm&#39;</span> <span class="ow">or</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;vmis&#39;</span><span class="p">:</span>
        <span class="c1"># warning reshape from (pts,ncomp) to (ncomp,pts)</span>
        <span class="n">vm_out</span> <span class="o">=</span> <span class="n">vm_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sig_out</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">sig_out</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm_out</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;s1&#39;</span> <span class="ow">or</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;s2&#39;</span> <span class="ow">or</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s1">&#39;angle&#39;</span><span class="p">):</span>  <span class="c1"># noqa: E501</span>
        <span class="n">princ_sig_out</span> <span class="o">=</span> <span class="n">princ_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sig_out</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>

        <span class="n">sig_out</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">princ_sig_out</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- WARNING!!! full sig_out matrix calculated here --&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sig_out</span></div>


<span class="k">def</span> <span class="nf">sig_component_per_node</span><span class="p">(</span><span class="n">stress_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a 2d numpy array of stress components per OpenSees node.</span>

<span class="sd">    Three first stress components (sxx, syy, sxy) are calculated and</span>
<span class="sd">    extracted from OpenSees, while the rest svm (Huber-Mieses-Hencky),</span>
<span class="sd">    two principal stresses (s1, s2) and directional angle are calculated</span>
<span class="sd">    as postprocessed quantities.</span>

<span class="sd">    Args:</span>
<span class="sd">        how_many (str): supported options are: &#39;all&#39; - all components,</span>
<span class="sd">            &#39;sxx&#39;, &#39;syy&#39;, &#39;sxy&#39;, &#39;svm&#39; (or &#39;vmis&#39;), &#39;s1&#39;, &#39;s2&#39;, &#39;angle&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sig_out (ndarray): a 2d array of stress components per node with</span>
<span class="sd">            the following components: sxx, syy, sxy, svm, s1, s2, angle.</span>
<span class="sd">            Size (n_nodes x 7).</span>

<span class="sd">    Examples:</span>
<span class="sd">        sig_out = opsv.sig_out_per_node()</span>

<span class="sd">    Notes:</span>
<span class="sd">       s1, s2: principal stresses</span>
<span class="sd">       angle: angle of the principal stress s1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ele_tags_all</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">stress_2d_ele_tags_only</span><span class="p">(</span><span class="n">ele_tags_all</span><span class="p">)</span>

    <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_tags</span><span class="p">)</span>

    <span class="c1"># initialize helper arrays</span>
    <span class="n">sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="n">nodes_tag_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span>

    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nen</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">tmp_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

        <span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SSPquad</span><span class="p">:</span>
            <span class="n">sig_ip_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">)</span>
            <span class="c1"># sigM_nd = sigM_ip</span>
            <span class="n">sigM_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">sig_ip_el</span><span class="p">,</span> <span class="p">(</span><span class="n">nen</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig_nd_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stressAtNodes&#39;</span><span class="p">)</span>
            <span class="n">sigM_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sig_nd_el</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="c1"># sxx yy xy components</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">sig_out</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigM_nd</span><span class="p">[:</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">indxs</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># n_indxs &lt; n_nodes: e.g. 21&lt;25 (bous), 2&lt;6 (2el) etc.</span>
    <span class="n">n_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">indxs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># divide summed stresses by the number of common nodes</span>
    <span class="n">sig_out</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> \
        <span class="n">sig_out</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span><span class="o">/</span><span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">indxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_indxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;sxx&#39;</span><span class="p">:</span>
        <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">sig_out</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;syy&#39;</span><span class="p">:</span>
        <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">sig_out</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;sxy&#39;</span><span class="p">:</span>
        <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">sig_out</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;svm&#39;</span> <span class="ow">or</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;vmis&#39;</span><span class="p">:</span>
        <span class="c1"># warning reshape from (pts,ncomp) to (ncomp,pts)</span>
        <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">vm_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sig_out</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;s1&#39;</span> <span class="ow">or</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;s2&#39;</span> <span class="ow">or</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;angle&#39;</span><span class="p">):</span>
        <span class="n">princ_sig_out</span> <span class="o">=</span> <span class="n">princ_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sig_out</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;s1&#39;</span><span class="p">:</span>
            <span class="c1"># sig_out_vec = np.transpose(princ_sig_out)[:, 0]</span>
            <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">princ_sig_out</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;s2&#39;</span><span class="p">:</span>
            <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">princ_sig_out</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="n">stress_str</span> <span class="o">==</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span>
            <span class="n">sig_out_vec</span> <span class="o">=</span> <span class="n">princ_sig_out</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">sig_out_vec</span>


<span class="k">def</span> <span class="nf">princ_stress</span><span class="p">(</span><span class="n">sig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a tuple (s1, s2, angle): principal stresses (plane stress) and angle</span>
<span class="sd">    Args:</span>
<span class="sd">        sig (ndarray): input array of stresses at nodes: sxx, syy, sxy (tau)</span>

<span class="sd">    Returns:</span>
<span class="sd">        out (ndarray): 1st row is first principal stress s1, 2nd row is second</span>
<span class="sd">           principal stress s2, 3rd row is the angle of s1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sig</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">-</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ds</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">+</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">R</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">+</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">R</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">angle</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span> <span class="nf">vm_stress</span><span class="p">(</span><span class="n">sig</span><span class="p">):</span>
    <span class="n">n_sig_comp</span><span class="p">,</span> <span class="n">n_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_sig_comp</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">sig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="n">z</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>

    <span class="n">_a</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">6.</span><span class="o">*</span><span class="p">(</span><span class="n">xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yz</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sig_out_per_ele_quad</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract stress components for all elements from OpenSees analysis.</span>

<span class="sd">    Returns:</span>
<span class="sd">        eles_ips_sig_out, eles_nds_sig_out (tuple of ndarrays):</span>
<span class="sd">            eles_ips_sig_out - values at integration points of elements</span>
<span class="sd">            (n_eles x 4 x 4)</span>
<span class="sd">            eles_nds_sig_out - values at nodes of elements (n_eles x 4 x 4)</span>
<span class="sd">    Examples:</span>
<span class="sd">        eles_ips_sig_out, eles_nds_sig_out = opsv.sig_out_per_ele_quad()</span>

<span class="sd">    Notes:</span>
<span class="sd">        Stress components in array columns are: Sxx, Syy, Sxy, Svmis, empty</span>
<span class="sd">        Used e.g. by plot_mesh_with_ips_2d function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_tags</span><span class="p">,</span> <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">(),</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_eles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_tags</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span>

    <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">eles_ips_sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_eles</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">eles_nds_sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_eles</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># array (n_nodes, 2):</span>
    <span class="c1"># node_tags, number of occurrence in quad elements)</span>
    <span class="c1"># correspondence indx and node_tag is in node_tags.index</span>
    <span class="c1"># (a) data in np.array of integers</span>
    <span class="n">nodes_tag_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span>

    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nen</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">tmp_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

        <span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">sig_ip_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">)</span>
        <span class="n">sigM_ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sig_ip_el</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">sig_nd_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stressAtNodes&#39;</span><span class="p">)</span>
        <span class="n">sigM_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sig_nd_el</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigM_ip</span>
        <span class="n">eles_nds_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigM_nd</span>

        <span class="n">vm_ip_out</span> <span class="o">=</span> <span class="n">vm_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">vm_nd_out</span> <span class="o">=</span> <span class="n">extrapolate_ip_to_node_quad</span><span class="p">(</span><span class="n">vm_ip_out</span><span class="p">)</span>
        <span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm_ip_out</span>
        <span class="n">eles_nds_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm_nd_out</span>

    <span class="k">return</span> <span class="n">eles_ips_sig_out</span><span class="p">,</span> <span class="n">eles_nds_sig_out</span>


<span class="k">def</span> <span class="nf">sig_out_per_ele_brick</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract stress components for all elements from OpenSees analysis.</span>

<span class="sd">    Returns:</span>
<span class="sd">        eles_ips_sig_out, eles_nds_sig_out (tuple of ndarrays):</span>
<span class="sd">            eles_ips_sig_out - values at integration points of elements</span>
<span class="sd">            (n_eles x 4 x 4)</span>
<span class="sd">            eles_nds_sig_out - values at nodes of elements (n_eles x 4 x 4)</span>
<span class="sd">    Examples:</span>
<span class="sd">        eles_ips_sig_out, eles_nds_sig_out = opsv.sig_out_per_ele_quad()</span>

<span class="sd">    Notes:</span>
<span class="sd">        Stress components in array columns are: Sxx, Syy, Sxy, Svmis, empty</span>
<span class="sd">        Used e.g. by plot_mesh_with_ips_2d function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_tags</span><span class="p">,</span> <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">(),</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_eles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_tags</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span>

    <span class="n">eles_ips_sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_eles</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">eles_nds_sig_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_eles</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

    <span class="c1"># array (n_nodes, 2):</span>
    <span class="c1"># node_tags, number of occurrence in quad elements)</span>
    <span class="c1"># correspondence indx and node_tag is in node_tags.index</span>
    <span class="c1"># (a) data in np.array of integers</span>
    <span class="n">nodes_tag_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nodes_tag_count</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nen</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">tmp_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

        <span class="c1"># nodes_tag_count[[ind1, ind2, ind3, ind4, ind5, ind6, ind7, ind8], 1] += 1</span>
        <span class="n">nodes_tag_count</span><span class="p">[</span><span class="n">tmp_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">sig_ip_el</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;stresses&#39;</span><span class="p">)</span>
        <span class="n">sigM_ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sig_ip_el</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># rearrange rows because stdBrick gauss points are ordered differently</span>
        <span class="n">rows_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">sigM_ip</span> <span class="o">=</span> <span class="n">sigM_ip</span><span class="p">[</span><span class="n">rows_order</span><span class="p">]</span>

        <span class="n">sigM_nd</span> <span class="o">=</span> <span class="n">extrapolate_ip_to_node_brick</span><span class="p">(</span><span class="n">sigM_ip</span><span class="p">)</span>
        <span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigM_ip</span>
        <span class="n">eles_nds_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigM_nd</span>

        <span class="n">vm_ip_out</span> <span class="o">=</span> <span class="n">vm_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">vm_nd_out</span> <span class="o">=</span> <span class="n">vm_stress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">eles_nds_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">eles_ips_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm_ip_out</span>
        <span class="n">eles_nds_sig_out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm_nd_out</span>

    <span class="k">return</span> <span class="n">eles_ips_sig_out</span><span class="p">,</span> <span class="n">eles_nds_sig_out</span>


<span class="k">def</span> <span class="nf">quads_to_4tris</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">,</span> <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get triangles connectivity, coordinates and new values at quad centroids.</span>

<span class="sd">    Args:</span>
<span class="sd">        quads_conn (ndarray):</span>

<span class="sd">        nds_crd (ndarray):</span>

<span class="sd">        nds_val (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn, nds_c_crd, nds_c_val (tuple):</span>

<span class="sd">    Notes:</span>
<span class="sd">        Triangles connectivity array is based on</span>
<span class="sd">        quadrilaterals connectivity.</span>
<span class="sd">        Each quad is split into four triangles.</span>
<span class="sd">        New nodes are created at the quad centroid.</span>

<span class="sd">    See also:</span>
<span class="sd">        function: quads_to_8tris_9n, quads_to_8tris_8n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_quads</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quads_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_nds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># coordinates and values at quad centroids _c_</span>
    <span class="n">nds_c_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_quads</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">nds_c_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_quads</span><span class="p">)</span>

    <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">n_quads</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quad_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">quad_conn</span>

        <span class="c1"># quad centroids</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span>


<span class="k">def</span> <span class="nf">bricks_to_24tris</span><span class="p">(</span><span class="n">bricks_conn</span><span class="p">,</span> <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">,</span> <span class="n">disps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get triangles connectivity, coordinates and new vals at brick face centroids.</span>

<span class="sd">    Args:</span>
<span class="sd">        bricks_conn (ndarray):</span>

<span class="sd">        nds_crd (ndarray):</span>

<span class="sd">        nds_val (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn, nds_c_crd, nds_c_val (tuple):</span>

<span class="sd">    Notes:</span>
<span class="sd">        Triangles connectivity array is based on</span>
<span class="sd">        stdBricks connectivity.</span>
<span class="sd">        Each of 6 brick faces is split into four triangles.</span>
<span class="sd">        New nodes are created at the face centroid.</span>

<span class="sd">    See also:</span>
<span class="sd">        function: bricks_to_8tris_9n, bricks_to_8tris_8n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_bricks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bricks_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_nds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># coordinates and values at brick centroids _c_</span>
    <span class="n">nds_c_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">nds_c_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">disps_c</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">disps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">disps_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">24</span><span class="o">*</span><span class="n">n_bricks</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brick_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bricks_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span> <span class="o">=</span> <span class="n">brick_conn</span>

        <span class="c1"># brick centroids</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>

        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">disps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

    <span class="k">return</span> <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span><span class="p">,</span> <span class="n">disps_c</span>


<span class="c1"># brick20n bricks to tris</span>
<span class="k">def</span> <span class="nf">bricks_to_48tris</span><span class="p">(</span><span class="n">bricks_conn</span><span class="p">,</span> <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">,</span> <span class="n">disps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get triangles connectivity, coordinates and new vals at brick face centroids,</span>
<span class="sd">    for brick20n</span>

<span class="sd">    Args:</span>
<span class="sd">        bricks_conn (ndarray):</span>

<span class="sd">        nds_crd (ndarray):</span>

<span class="sd">        nds_val (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn, nds_c_crd, nds_c_val (tuple):</span>

<span class="sd">    Notes:</span>
<span class="sd">        Triangles connectivity array is based on</span>
<span class="sd">        stdBricks connectivity.</span>
<span class="sd">        Each of 6 brick faces is split into four triangles.</span>
<span class="sd">        New nodes are created at the face centroid.</span>

<span class="sd">    See also:</span>
<span class="sd">        function: bricks_to_24tris</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_bricks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bricks_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_nds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># coordinates and values at brick centroids _c_</span>
    <span class="n">nds_c_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">nds_c_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">disps_c</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">disps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">disps_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bricks</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">48</span><span class="o">*</span><span class="n">n_bricks</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brick_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bricks_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">48</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n10</span><span class="p">,</span> <span class="n">n11</span><span class="p">,</span> <span class="n">n12</span><span class="p">,</span> <span class="n">n13</span><span class="p">,</span> \
            <span class="n">n14</span><span class="p">,</span> <span class="n">n15</span><span class="p">,</span> <span class="n">n16</span><span class="p">,</span> <span class="n">n17</span><span class="p">,</span> <span class="n">n18</span><span class="p">,</span> <span class="n">n19</span> <span class="o">=</span> <span class="n">brick_conn</span>

        <span class="c1"># brick centroids</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">4.</span><span class="p">])</span>

        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">]])</span><span class="o">/</span><span class="mf">4.</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n8</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n17</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n17</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n12</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n12</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n16</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n16</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n9</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n18</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n18</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n13</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n13</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n17</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n17</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n10</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n10</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n19</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n19</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n14</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n14</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n18</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n18</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n11</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n11</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n16</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n16</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">28</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n15</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">29</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n15</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n19</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n19</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n12</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">33</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n12</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n13</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n13</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">36</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n14</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">37</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n14</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">38</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n15</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">39</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n15</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>

        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n8</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">42</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">43</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n9</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">44</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n10</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">45</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n10</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">46</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n11</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">47</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n11</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">disps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span>
                                         <span class="n">n8</span><span class="p">,</span> <span class="n">n17</span><span class="p">,</span> <span class="n">n12</span><span class="p">,</span> <span class="n">n16</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span>
                                           <span class="n">n9</span><span class="p">,</span> <span class="n">n18</span><span class="p">,</span> <span class="n">n13</span><span class="p">,</span> <span class="n">n17</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span>
                                           <span class="n">n10</span><span class="p">,</span> <span class="n">n19</span><span class="p">,</span> <span class="n">n14</span><span class="p">,</span> <span class="n">n18</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span>
                                           <span class="n">n11</span><span class="p">,</span> <span class="n">n16</span><span class="p">,</span> <span class="n">n15</span><span class="p">,</span> <span class="n">n19</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span>
                                           <span class="n">n12</span><span class="p">,</span> <span class="n">n13</span><span class="p">,</span> <span class="n">n14</span><span class="p">,</span> <span class="n">n15</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">disps_c</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">disps</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span>
                                           <span class="n">n8</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n10</span><span class="p">,</span> <span class="n">n11</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

    <span class="k">return</span> <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span><span class="p">,</span> <span class="n">disps_c</span>


<span class="k">def</span> <span class="nf">tetra4n_to_4tris</span><span class="p">(</span><span class="n">tetras4n_conn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get triangles connectivity.</span>

<span class="sd">    Four-node tetrahedron is subdivided into four triangles</span>

<span class="sd">    Args:</span>
<span class="sd">        tetra4n_conn (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn_subdiv (ndarray):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_tetras</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tetras4n_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># n_nds, _ = nds_crd.shape</span>

    <span class="n">tris_conn_subdiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">n_tetras</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tetra4n_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tetras4n_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">tetra4n_conn</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n1</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tris_conn_subdiv</span>


<span class="k">def</span> <span class="nf">tetra10n_to_16tris</span><span class="p">(</span><span class="n">tetras10n_conn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get triangles connectivity.</span>

<span class="sd">    Six-node triangle is subdivided into four triangles</span>

<span class="sd">    Args:</span>
<span class="sd">        tetra10n_conn (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn_subdiv (ndarray):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_tetras</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tetras10n_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># n_nds, _ = nds_crd.shape</span>

    <span class="n">tris_conn_subdiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">16</span><span class="o">*</span><span class="n">n_tetras</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tetra10n_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tetras10n_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">16</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n9</span> <span class="o">=</span> <span class="n">tetra10n_conn</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n6</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n5</span><span class="p">])</span>

        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n4</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n7</span><span class="p">])</span>

        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n7</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n6</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n9</span><span class="p">])</span>

        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n9</span><span class="p">,</span> <span class="n">n5</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n8</span><span class="p">,</span> <span class="n">n9</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tris_conn_subdiv</span>


<span class="k">def</span> <span class="nf">tris6n_to_4tris</span><span class="p">(</span><span class="n">tris_conn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get triangles connectivity.</span>

<span class="sd">    Six-node triangle is subdivided into four triangles</span>

<span class="sd">    Args:</span>
<span class="sd">        tris_conn (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn_subdiv (ndarray):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_tris</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tris_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># n_nds, _ = nds_crd.shape</span>

    <span class="n">tris_conn_subdiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">n_tris</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tri_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tris_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span> <span class="o">=</span> <span class="n">tri_conn</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n5</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n4</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">])</span>
        <span class="n">tris_conn_subdiv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tris_conn_subdiv</span>


<span class="k">def</span> <span class="nf">plot_mesh_2d</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">,</span> <span class="n">eles_conn</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot 2d mesh (quads or triangles) outline.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">eles_conn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_conn</span> <span class="ow">in</span> <span class="n">eles_conn</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[</span><span class="n">ele_conn</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[</span><span class="n">ele_conn</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_conn</span> <span class="ow">in</span> <span class="n">eles_conn</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_conn</span> <span class="ow">in</span> <span class="n">eles_conn</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>
                        <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>
                        <span class="mi">1</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_conn</span> <span class="ow">in</span> <span class="n">eles_conn</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>
                        <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="p">[[</span><span class="n">ele_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                         <span class="n">ele_conn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ele_conn</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>
                        <span class="mi">1</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="plot_stress_2d"><a class="viewcode-back" href="../plot_stress_2d.html#opsvis.plot_stress_2d">[docs]</a><span class="k">def</span> <span class="nf">plot_stress_2d</span><span class="p">(</span><span class="n">nds_val</span><span class="p">,</span> <span class="n">mesh_outline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;turbo&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot stress distribution of a 2d elements of a 2d model.</span>

<span class="sd">    Args:</span>
<span class="sd">        nds_val (ndarray): the values of a stress component, which can</span>
<span class="sd">            be extracted from sig_out array (see sig_out_per_node</span>
<span class="sd">            function)</span>

<span class="sd">        mesh_outline (int): 1 - mesh is plotted, 0 - no mesh plotted.</span>

<span class="sd">        cmap (str): Matplotlib color map (default is &#39;turbo&#39;)</span>

<span class="sd">    Usage:</span>
<span class="sd">        ::</span>

<span class="sd">            sig_out = opsv.sig_out_per_node()</span>
<span class="sd">            j, jstr = 3, &#39;vmis&#39;</span>
<span class="sd">            nds_val = sig_out[:, j]</span>
<span class="sd">            opsv.plot_stress_2d(nds_val)</span>
<span class="sd">            plt.xlabel(&#39;x [m]&#39;)</span>
<span class="sd">            plt.ylabel(&#39;y [m]&#39;)</span>
<span class="sd">            plt.title(f&#39;{jstr}&#39;)</span>
<span class="sd">            plt.show()</span>

<span class="sd">    See also:</span>

<span class="sd">    :ref:`opsvis_sig_out_per_node`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node_tags</span><span class="p">,</span> <span class="n">ele_tags_all</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">(),</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">stress_2d_ele_tags_only</span><span class="p">(</span><span class="n">ele_tags_all</span><span class="p">)</span>

    <span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_eles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_tags</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span>

    <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">):</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">):</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">):</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">):</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="c1"># nen = np.shape(ops.eleNodes(ele_tags[0]))[0]</span>

    <span class="c1"># idiom coordinates as ordered in node_tags</span>
    <span class="c1"># use node_tags.index(tag) for correspondence</span>
    <span class="n">nds_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_tags</span><span class="p">):</span>
        <span class="n">nds_crd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

    <span class="c1"># from utils / sig_out_per_node</span>
    <span class="c1"># fixme: if this can be simplified</span>
    <span class="c1"># index (starts from 0) to node_tag correspondence</span>
    <span class="c1"># (a) data in np.array of integers</span>
    <span class="c1"># nodes_tag_count = np.zeros((n_nodes, 2), dtype=int)</span>
    <span class="c1"># nodes_tag_count[:, 0] = node_tags</span>
    <span class="c1">#</span>
    <span class="c1"># correspondence indx and node_tag is in node_tags.index</span>
    <span class="c1"># after testing remove the above</span>

    <span class="n">eles_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_eles</span><span class="p">,</span> <span class="n">nen</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
            <span class="n">eles_conn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">):</span>
        <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">eles_conn</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>
        <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span> <span class="o">=</span> \
            <span class="n">quads_to_4tris</span><span class="p">(</span><span class="n">eles_conn</span><span class="p">,</span> <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">)</span>

        <span class="n">nds_crd_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">))</span>
        <span class="n">nds_val_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">nds_val</span><span class="p">,</span> <span class="n">nds_c_val</span><span class="p">))</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">):</span>
        <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">tris6n_to_4tris</span><span class="p">(</span><span class="n">eles_conn</span><span class="p">)</span>
        <span class="n">nds_crd_all</span> <span class="o">=</span> <span class="n">nds_crd</span>
        <span class="n">nds_val_all</span> <span class="o">=</span> <span class="n">nds_val</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">):</span>
        <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span> <span class="o">=</span> <span class="n">quads_to_8tris_8n</span><span class="p">(</span><span class="n">eles_conn</span><span class="p">,</span>
                                                            <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">)</span>

        <span class="n">nds_crd_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">))</span>
        <span class="n">nds_val_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">nds_val</span><span class="p">,</span> <span class="n">nds_c_val</span><span class="p">))</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">):</span>
        <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">quads_to_8tris_9n</span><span class="p">(</span><span class="n">eles_conn</span><span class="p">)</span>
        <span class="n">nds_crd_all</span> <span class="o">=</span> <span class="n">nds_crd</span>
        <span class="n">nds_val_all</span> <span class="o">=</span> <span class="n">nds_val</span>



    <span class="c1"># 1. plot contour maps</span>
    <span class="n">triangulation</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">nds_crd_all</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                      <span class="n">nds_crd_all</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="n">tris_conn</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">triangulation</span><span class="p">,</span> <span class="n">nds_val_all</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="c1"># 2. plot original mesh (quad) without subdivision into triangles</span>
    <span class="k">if</span> <span class="n">mesh_outline</span><span class="p">:</span>
        <span class="n">plot_mesh_2d</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">,</span> <span class="n">eles_conn</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<span class="c1"># see also quads_to_8tris_9n</span>
<span class="k">def</span> <span class="nf">quads_to_8tris_8n</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">,</span> <span class="n">nds_crd</span><span class="p">,</span> <span class="n">nds_val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get triangles connectivity, coordinates and new values at quad centroids.</span>

<span class="sd">    Args:</span>
<span class="sd">        quads_conn (ndarray):</span>

<span class="sd">        nds_crd (ndarray):</span>

<span class="sd">        nds_val (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn, nds_c_crd, nds_c_val (tuple):</span>

<span class="sd">    Notes:</span>
<span class="sd">        Triangles connectivity array is based on</span>
<span class="sd">        quadrilaterals connectivity.</span>
<span class="sd">        Each quad is split into eight triangles.</span>
<span class="sd">        New nodes are created at the quad centroid.</span>

<span class="sd">    See also:</span>
<span class="sd">        function: quads_to_8tris_9n, quads_to_4tris</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_quads</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quads_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_nds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nds_crd</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># coordinates and values at quad centroids _c_</span>
    <span class="n">nds_c_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_quads</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">nds_c_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_quads</span><span class="p">)</span>

    <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="o">*</span><span class="n">n_quads</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quad_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span> <span class="o">=</span> <span class="n">quad_conn</span>

        <span class="c1"># quad centroids</span>
        <span class="c1"># nds_c_crd[i] = np.array([np.sum(nds_crd[[n0, n1, n2, n3], 0])/4.,</span>
        <span class="c1">#                          np.sum(nds_crd[[n0, n1, n2, n3], 1])/4.])</span>
        <span class="c1"># nds_c_val[i] = np.sum(nds_val[[n0, n1, n2, n3]])/4.</span>
        <span class="n">nds_c_crd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">quad8n_val_at_center</span><span class="p">(</span><span class="n">nds_crd</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span>
                                                     <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span>
        <span class="n">nds_c_val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">quad8n_val_at_center</span><span class="p">(</span><span class="n">nds_val</span><span class="p">[[</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span>
                                                     <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">]])</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n_nds</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tris_conn</span><span class="p">,</span> <span class="n">nds_c_crd</span><span class="p">,</span> <span class="n">nds_c_val</span>


<span class="c1"># see also quads_to_8tris_8n</span>
<span class="k">def</span> <span class="nf">quads_to_8tris_9n</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get triangles connectivity, coordinates and new values at quad centroids.</span>

<span class="sd">    Args:</span>
<span class="sd">        quads_conn (ndarray):</span>

<span class="sd">        nds_crd (ndarray):</span>

<span class="sd">        nds_val (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        tris_conn, nds_c_crd, nds_c_val (tuple):</span>

<span class="sd">    Notes:</span>
<span class="sd">        Triangles connectivity array is based on</span>
<span class="sd">        quadrilaterals connectivity.</span>
<span class="sd">        Each quad is split into eight triangles.</span>
<span class="sd">        New nodes are created at the quad centroid.</span>

<span class="sd">    See also:</span>
<span class="sd">        function: quads_to_8tris_8n, quads_to_4tris</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_quads</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quads_conn</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># n_nds, _ = nds_crd.shape</span>

    <span class="n">tris_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="o">*</span><span class="n">n_quads</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quad_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quads_conn</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">i</span>
        <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n8</span> <span class="o">=</span> <span class="n">quad_conn</span>

        <span class="c1"># center nodeds already present in quad 9n</span>

        <span class="c1"># triangles connectivity</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n0</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n4</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n5</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2</span><span class="p">,</span> <span class="n">n6</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n6</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n3</span><span class="p">,</span> <span class="n">n7</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>
        <span class="n">tris_conn</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n7</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n8</span><span class="p">])</span>

    <span class="c1"># return tris_conn, nds_c_crd, nds_c_val</span>
    <span class="k">return</span> <span class="n">tris_conn</span>


<span class="k">def</span> <span class="nf">quad8n_val_at_center</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate values at the center of 8-node quad element.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">val_c1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="c1"># val_c1 = -np.sum(vals[[0, 1, 2, 3]], axis=0)/4 + np.sum(vals[[4, 5, 6, 7]], axis=0)/2  # noqa: E501</span>
    <span class="c1"># val_c2 = -np.sum(vals[[0, 1, 2, 3]], axis=0)/4 + np.sum(vals[[4, 5, 6, 7]], axis=0)/2  # noqa: E501</span>
    <span class="c1"># val_c3 = np.mean(vals[[4, 5, 6, 7]], axis=0)</span>
    <span class="c1"># val_c4 = np.mean(vals[[0, 1, 2, 3]], axis=0)</span>
    <span class="c1"># val_c5 = np.mean(vals, axis=0)</span>
    <span class="c1"># return val_c1, val_c2, val_c3, val_c4, val_c5</span>

    <span class="k">return</span> <span class="n">val_c1</span>


<span class="k">def</span> <span class="nf">plot_stress</span><span class="p">(</span><span class="n">stress_str</span><span class="p">,</span> <span class="n">mesh_outline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;turbo&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot stress distribution of the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        stress_str (string): stress component string. Available options are:</span>
<span class="sd">            &#39;sxx&#39;, &#39;syy&#39;, &#39;sxy&#39;, &#39;vmis&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;alpha&#39;</span>

<span class="sd">        mesh_outline (int): 1 - mesh is plotted, 0 - no mesh plotted.</span>

<span class="sd">        cmap (str): Matplotlib color map (default is &#39;turbo&#39;)</span>

<span class="sd">        levels (int): number and positions of the contour lines / regions.</span>

<span class="sd">    Usage:</span>
<span class="sd">        ::</span>

<span class="sd">            opsv.plot_stress(&#39;vmis&#39;)</span>
<span class="sd">            plt.xlabel(&#39;x [m]&#39;)</span>
<span class="sd">            plt.ylabel(&#39;y [m]&#39;)</span>
<span class="sd">            plt.show()</span>

<span class="sd">    See also:</span>

<span class="sd">    :ref:`opsvis_sig_out_per_node`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># az_el - azimut, elevation used for 3d plots only</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">_plot_stress_2d</span><span class="p">(</span><span class="n">stress_str</span><span class="p">,</span> <span class="n">mesh_outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
        <span class="c1"># if axis_off:</span>
        <span class="c1">#     plt.axis(&#39;off&#39;)</span>

    <span class="c1"># not implemented yet</span>
    <span class="c1"># elif ndim == 3:</span>
    <span class="c1">#     _plot_stress_3d(stress_str, mesh_outline, cmap, levels)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not implemented yet.&#39;</span><span class="p">)</span>

    <span class="c1"># plt.show()  # call this from main py file for more control</span>


<span class="k">def</span> <span class="nf">_plot_stress_2d</span><span class="p">(</span><span class="n">stress_str</span><span class="p">,</span> <span class="n">mesh_outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">levels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;See documentation for plot_stress command&quot;&quot;&quot;</span>

    <span class="c1"># node_tags = ops.getNodeTags()</span>
    <span class="c1"># ele_tags = ops.getEleTags()</span>
    <span class="c1"># n_nodes = len(node_tags)</span>

    <span class="c1"># second version - better - possible different types</span>
    <span class="c1"># of elements (mix of quad and tri)</span>
    <span class="c1"># for ele_tag in ele_tags:</span>
    <span class="c1">#     nen = np.shape(ops.eleNodes(ele_tag))[0]</span>

    <span class="c1"># avoid calculating and storing all stress components</span>
    <span class="c1"># sig_out = sig_out_per_node(stress_str)</span>
    <span class="c1"># switcher = {&#39;sxx&#39;: 0,</span>
    <span class="c1">#             &#39;syy&#39;: 1,</span>
    <span class="c1">#             &#39;sxy&#39;: 2,</span>
    <span class="c1">#             &#39;svm&#39;: 3,</span>
    <span class="c1">#             &#39;vmis&#39;: 3,</span>
    <span class="c1">#             &#39;s1&#39;: 4,</span>
    <span class="c1">#             &#39;s2&#39;: 5,</span>
    <span class="c1">#             &#39;angle&#39;: 6}</span>

    <span class="c1"># nds_val = sig_out[:, switcher[stress_str]]</span>

    <span class="n">nds_val</span> <span class="o">=</span> <span class="n">sig_component_per_node</span><span class="p">(</span><span class="n">stress_str</span><span class="p">)</span>
    <span class="n">plot_stress_2d</span><span class="p">(</span><span class="n">nds_val</span><span class="p">,</span> <span class="n">mesh_outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>


<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">defo</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># fix</span>
<span class="c1"># def section_force_distribution_2d(ex, ey, pl, nep=2,</span>
<span class="c1">#                                   ele_load_data=[&#39;-beamUniform&#39;, 0., 0.]):</span>
<span class="k">def</span> <span class="nf">section_force_distribution_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">ele_load_data</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate section forces (N, V, M) for an elastic 2D Euler-Bernoulli beam.</span>

<span class="sd">    Input:</span>
<span class="sd">    ex, ey - x, y element coordinates in global system</span>
<span class="sd">    nep - number of evaluation points, by default (2) at element ends</span>
<span class="sd">    ele_load_list - list of transverse and longitudinal element load</span>
<span class="sd">      syntax: [ele_load_type, Wy, Wx]</span>
<span class="sd">      For now only &#39;-beamUniform&#39; element load type is acceptable</span>

<span class="sd">    Output:</span>
<span class="sd">    s = [N V M]; shape: (nep,3)</span>
<span class="sd">        section forces at nep points along local x</span>
<span class="sd">    xl: coordinates of local x-axis; shape: (nep,)</span>

<span class="sd">    Use it with dia_sf to draw N, V, M diagrams.</span>

<span class="sd">    nep : int</span>
<span class="sd">        number of evaluation points, by default (2) at element ends</span>
<span class="sd">        If the element load is between the points then nep is increased by 1 or 2</span>

<span class="sd">    TODO: add &#39;-beamPoint&#39; element load type</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">Lxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>

    <span class="n">nlf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">ele_load_data_i</span> <span class="ow">in</span> <span class="n">ele_load_data</span><span class="p">:</span>
        <span class="n">ele_load_type</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># trusses</span>
            <span class="n">N_1</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># plane frames</span>
            <span class="c1"># N_1, V_1, M_1 = pl[0], pl[1], pl[2]</span>
            <span class="n">N_1</span><span class="p">,</span> <span class="n">V_1</span><span class="p">,</span> <span class="n">M_1</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Not supported. Number of nodal forces: </span><span class="si">{nlf}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamUniform&#39;</span><span class="p">:</span>
            <span class="c1"># raise ValueError</span>
            <span class="c1"># raise NameError</span>

            <span class="n">n_ele_load_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_load_data_i</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># eload_type, Wy, Wx = ele_load_data[0], ele_load_data[1], ele_load_data[2]</span>
                <span class="n">Wy</span><span class="p">,</span> <span class="n">Wx</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="n">N</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">N_1</span> <span class="o">*</span> <span class="n">one</span> <span class="o">+</span> <span class="n">Wx</span> <span class="o">*</span> <span class="n">xl</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">one</span> <span class="o">+</span> <span class="n">Wy</span> <span class="o">*</span> <span class="n">xl</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="o">-</span><span class="n">M_1</span> <span class="o">*</span> <span class="n">one</span> <span class="o">+</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Wy</span> <span class="o">*</span> <span class="n">xl</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">aL</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="n">bL</span><span class="o">*</span><span class="n">L</span>

                <span class="n">bma</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>

                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">xl</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">xl</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>
                    <span class="n">nep</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">xl</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">xl</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
                    <span class="n">nep</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


                <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">xl</span><span class="p">):</span>
                    <span class="n">xma</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span>
                    <span class="n">wtx</span> <span class="o">=</span> <span class="n">wta</span> <span class="o">+</span> <span class="p">(</span><span class="n">wtb</span> <span class="o">-</span> <span class="n">wta</span><span class="p">)</span> <span class="o">*</span> <span class="n">xma</span> <span class="o">/</span> <span class="n">bma</span>
                    <span class="c1"># xc = a + bma * (wtb + 2*wta) / (3 * (wta + wtb))</span>
                    <span class="k">if</span> <span class="n">wtx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">xc</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xc</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">xma</span> <span class="o">*</span> <span class="p">(</span><span class="n">wtx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">wta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">wta</span> <span class="o">+</span> <span class="n">wtx</span><span class="p">))</span>

                    <span class="n">Ax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wtx</span><span class="o">+</span><span class="n">wta</span><span class="p">)</span> <span class="o">*</span> <span class="n">xma</span>
                    <span class="n">V1x</span> <span class="o">=</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">x</span>
                    <span class="n">Axxc</span> <span class="o">=</span> <span class="n">Ax</span> <span class="o">*</span> <span class="n">xc</span>

                    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
                        <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">N_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">wab</span> <span class="o">-</span> <span class="n">waa</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
                        <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_1</span> <span class="o">+</span> <span class="n">Ax</span>
                        <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">M_1</span> <span class="o">+</span> <span class="n">V1x</span> <span class="o">+</span> <span class="n">Axxc</span>

                    <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">aL</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">bL</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">N</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">N_1</span> <span class="o">*</span> <span class="n">one</span> <span class="o">+</span> <span class="n">wta</span> <span class="o">*</span> <span class="n">xl</span><span class="p">)</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">one</span> <span class="o">+</span> <span class="n">wta</span> <span class="o">*</span> <span class="n">xl</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamPoint&#39;</span><span class="p">:</span>
            <span class="n">Pt</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Pa</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">aL</span><span class="o">*</span><span class="n">L</span>

            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">xl</span><span class="p">:</span>
                <span class="c1"># idx = xl.searchsorted(a)</span>
                <span class="c1"># np.concatenate((xl[:idx], [a], xl[idx:]))</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">xl</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">a</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
                <span class="n">nep</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># idx = xl.searchsorted(a)</span>
                <span class="c1"># xl = np.concatenate((xl[:idx], [a], xl[idx:]))</span>
                <span class="c1"># idx = xl.searchsorted(a+0.001)</span>
                <span class="c1"># xl = np.concatenate((xl[:idx], [a+0.001], xl[idx:]))</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">xl</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">xl</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">a</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
                <span class="n">nep</span> <span class="o">+=</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">nlf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


            <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">xl</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">N_1</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_1</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">M_1</span> <span class="o">+</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">:</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="p">(</span><span class="n">N_1</span> <span class="o">+</span> <span class="n">Pa</span><span class="p">)</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_1</span> <span class="o">+</span> <span class="n">Pt</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">M_1</span> <span class="o">+</span> <span class="n">V_1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">Pt</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>

                <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="c1"># if eload_type == &#39;-beamUniform&#39;:</span>
    <span class="c1"># else:</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">nep</span>


<span class="k">def</span> <span class="nf">section_force_distribution_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">ele_load_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate section forces (N, Vy, Vz, T, My, Mz) for an elastic 3d beam.</span>

<span class="sd">    Longer description</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    ex : list</span>
<span class="sd">        x element coordinates</span>
<span class="sd">    ey : list</span>
<span class="sd">        y element coordinates</span>
<span class="sd">    ez : list</span>
<span class="sd">        z element coordinates</span>
<span class="sd">    pl : ndarray</span>
<span class="sd">    nep : int</span>
<span class="sd">        number of evaluation points, by default (2) at element ends</span>

<span class="sd">    ele_load_list : list</span>
<span class="sd">        list of transverse and longitudinal element load</span>
<span class="sd">        syntax: [ele_load_type, Wy, Wz, Wx]</span>
<span class="sd">        For now only &#39;-beamUniform&#39; element load type is acceptable.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    s : ndarray</span>
<span class="sd">        [N Vx Vy T My Mz]; shape: (nep,6)</span>
<span class="sd">        column vectors of section forces along local x-axis</span>

<span class="sd">    uvwfi : ndarray</span>
<span class="sd">        [u v w fi]; shape (nep,4)</span>
<span class="sd">        displacements at nep points along local x</span>

<span class="sd">    xl : ndarray</span>
<span class="sd">        coordinates of local x-axis; shape (nep,)</span>

<span class="sd">    nep : int</span>
<span class="sd">        number of evaluation points, by default (2) at element ends</span>
<span class="sd">        If the element load is between the points then nep is increased by 1 or 2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Todo: add &#39;-beamPoint&#39; element load type</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># eload_type = ele_load_data[0]</span>
    <span class="n">Wy</span><span class="p">,</span> <span class="n">Wz</span><span class="p">,</span> <span class="n">Wx</span> <span class="o">=</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">N1</span><span class="p">,</span> <span class="n">Vy1</span><span class="p">,</span> <span class="n">Vz1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">My1</span><span class="p">,</span> <span class="n">Mz1</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>

    <span class="n">N</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">N1</span><span class="o">*</span><span class="n">one</span> <span class="o">+</span> <span class="n">Wx</span><span class="o">*</span><span class="n">xl</span><span class="p">)</span>
    <span class="n">Vy</span> <span class="o">=</span> <span class="n">Vy1</span><span class="o">*</span><span class="n">one</span> <span class="o">+</span> <span class="n">Wy</span><span class="o">*</span><span class="n">xl</span>
    <span class="n">Vz</span> <span class="o">=</span> <span class="n">Vz1</span><span class="o">*</span><span class="n">one</span> <span class="o">+</span> <span class="n">Wz</span><span class="o">*</span><span class="n">xl</span>
    <span class="n">T</span> <span class="o">=</span> <span class="o">-</span><span class="n">T1</span><span class="o">*</span><span class="n">one</span>
    <span class="n">Mz</span> <span class="o">=</span> <span class="o">-</span><span class="n">Mz1</span><span class="o">*</span><span class="n">one</span> <span class="o">+</span> <span class="n">Vy1</span><span class="o">*</span><span class="n">xl</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Wy</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">My</span> <span class="o">=</span> <span class="n">My1</span><span class="o">*</span><span class="n">one</span> <span class="o">+</span> <span class="n">Vz1</span><span class="o">*</span><span class="n">xl</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Wz</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Vz</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mz</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">xl</span>


<div class="viewcode-block" id="section_force_diagram_2d"><a class="viewcode-back" href="../section_force_diagram_2d.html#opsvis.section_force_diagram_2d">[docs]</a><span class="k">def</span> <span class="nf">section_force_diagram_2d</span><span class="p">(</span><span class="n">sf_type</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span>
                             <span class="n">fmt_secforce</span><span class="o">=</span><span class="n">fmt_secforce</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display section forces diagram for 2d beam column model.</span>

<span class="sd">    This function plots a section forces diagram for 2d beam column elements</span>
<span class="sd">    with or without element loads. For now only &#39;-beamUniform&#39; constant</span>
<span class="sd">    transverse or axial element loads are supported.</span>

<span class="sd">    Args:</span>
<span class="sd">        sf_type (str): type of section force: &#39;N&#39; - normal force,</span>
<span class="sd">            &#39;V&#39; - shear force, &#39;M&#39; - bending moments.</span>

<span class="sd">        sfac (float): scale factor by wich the values of section forces are</span>
<span class="sd">            multiplied.</span>

<span class="sd">        nep (int): number of evaluation points including both end nodes</span>
<span class="sd">            (default: 17)</span>

<span class="sd">        fmt_secforce (str): format line string for section force distribution</span>
<span class="sd">            curve. The format contains information on line color, style and</span>
<span class="sd">            marks as in the standard matplotlib plot function.</span>
<span class="sd">            (default: fmt_secforce = &#39;b-&#39;  # blue solid line)</span>

<span class="sd">    Usage:</span>
<span class="sd">    ::</span>

<span class="sd">        sfacM = 5.e-5</span>
<span class="sd">        plt.figure()</span>
<span class="sd">        minVal, maxVal = opsv.section_force_diagram_2d(&#39;M&#39;, sfacM)</span>
<span class="sd">        plt.title(&#39;Bending moments&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxVal</span><span class="p">,</span> <span class="n">minVal</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">Ew</span> <span class="o">=</span> <span class="n">get_Ew_data_from_ops_domain</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>

        <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="c1"># element x, y coordinates</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="n">Lxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>
        <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">Lxy</span> <span class="o">/</span> <span class="n">L</span>

        <span class="n">ele_class_tag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">:</span>
            <span class="n">axial_force</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;axialForce&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">axial_force</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axial_force</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                <span class="n">fmt_color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                <span class="n">fmt_secforce</span> <span class="o">=</span> <span class="s1">&#39;b-&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                <span class="n">fmt_color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                <span class="n">fmt_secforce</span> <span class="o">=</span> <span class="s1">&#39;r-&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># by default no element load</span>
            <span class="n">eload_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">Ew</span><span class="p">:</span>
                <span class="n">eload_data</span> <span class="o">=</span> <span class="n">Ew</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

            <span class="n">pl</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;localForces&#39;</span><span class="p">)</span>

            <span class="n">s_all</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">nep</span> <span class="o">=</span> <span class="n">section_force_distribution_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">eload_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span> <span class="ow">or</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;axial&#39;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span> <span class="ow">or</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;shear&#39;</span> <span class="ow">or</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">or</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;moment&#39;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>


        <span class="n">minVal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">maxVal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">sfac</span>

        <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosa</span>
        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosb</span>

        <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

        <span class="c1"># positive M are opposite to N and V</span>
        <span class="k">if</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">or</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;moment&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>

        <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosb</span>
        <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosa</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># section force curve</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_secforce</span><span class="p">,</span>
                 <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                 <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># model</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                 <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># reference perpendicular lines</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                     <span class="n">fmt_secforce</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                     <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span>
                     <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ele_class_tag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">:</span>
            <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s_p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">axial_force</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fmt_color</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">minVal</span><span class="p">,</span> <span class="n">maxVal</span></div>


<div class="viewcode-block" id="section_force_diagram_3d"><a class="viewcode-back" href="../section_force_diagram_3d.html#opsvis.section_force_diagram_3d">[docs]</a><span class="k">def</span> <span class="nf">section_force_diagram_3d</span><span class="p">(</span><span class="n">sf_type</span><span class="p">,</span> <span class="n">Ew</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span>
                             <span class="n">fmt_secforce</span><span class="o">=</span><span class="n">fmt_secforce</span><span class="p">,</span> <span class="n">dir_plt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display section forces diagram of a 3d beam column model.</span>

<span class="sd">    This function plots section forces diagrams for 3d beam column elements</span>
<span class="sd">    with or without element loads. For now only &#39;-beamUniform&#39; constant</span>
<span class="sd">    transverse or axial element loads are supported.</span>

<span class="sd">    Args:</span>
<span class="sd">        sf_type (str): type of section force: &#39;N&#39; - normal force,</span>
<span class="sd">            &#39;Vy&#39; or &#39;Vz&#39; - shear force, &#39;My&#39; or &#39;Mz&#39; - bending moments,</span>
<span class="sd">            &#39;T&#39; - torsional moment.</span>

<span class="sd">        Ew (dict): Ew Python dictionary contains information on non-zero</span>
<span class="sd">            element loads, therfore each item of the Python dictionary</span>
<span class="sd">            is in the form: &#39;ele_tag: [&#39;-beamUniform&#39;, Wy, Wz, Wx]&#39;.</span>

<span class="sd">        sfac (float): scale factor by wich the values of section forces are</span>
<span class="sd">            multiplied.</span>

<span class="sd">        nep (int): number of evaluation points including both end nodes</span>
<span class="sd">            (default: 17)</span>

<span class="sd">        fmt_secforce (str): format line string for section force distribution</span>
<span class="sd">            curve. The format contains information on line color, style and</span>
<span class="sd">            marks as in the standard matplotlib plot function.</span>
<span class="sd">            (default: fmt_secforce = &#39;b-&#39;  # blue solid line)</span>

<span class="sd">        dir_plt {0, 1, 2}: direction in which to plot the load effects:</span>
<span class="sd">            0 (default) - as defined in the code for each load effect type</span>
<span class="sd">            1 - in the y-axis (default for N, Vy, T, Mz)</span>
<span class="sd">            2 - in the z-axis (default for Vz, My)</span>

<span class="sd">    Usage:</span>
<span class="sd">    ::</span>

<span class="sd">        Wy, Wz, Wx = -5., 0., 0.</span>
<span class="sd">        Ew = {3: [&#39;-beamUniform&#39;, Wy, Wz, Wx]}</span>
<span class="sd">        sfacMz = 1.e-1</span>
<span class="sd">        plt.figure()</span>
<span class="sd">        minY, maxY = opsv.section_force_diagram_3d(&#39;Mz&#39;, Ew, sfacMz)</span>
<span class="sd">        plt.title(f&#39;Bending moments Mz, max = {maxY:.2f}, min = {minY:.2f}&#39;)</span>

<span class="sd">    Todo:</span>

<span class="sd">    Add support for other element loads available in OpenSees: partial</span>
<span class="sd">    (trapezoidal) uniform element load, and &#39;beamPoint&#39; element load.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxVal</span><span class="p">,</span> <span class="n">minVal</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>
    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.985</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.94</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># ax.axis(&#39;equal&#39;)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

        <span class="c1"># by default no element load</span>
        <span class="n">eload_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">Ew</span><span class="p">:</span>
            <span class="n">eload_data</span> <span class="o">=</span> <span class="n">Ew</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

        <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="c1"># element x, y coordinates</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">2</span><span class="p">]])</span>

        <span class="c1"># eo = Eo[i, :]</span>
        <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
        <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
        <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>

        <span class="n">G</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">G</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">pl</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;localForces&#39;</span><span class="p">)</span>

        <span class="n">s_all</span><span class="p">,</span> <span class="n">xl</span> <span class="o">=</span> <span class="n">section_force_distribution_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span>
                                                  <span class="n">eload_data</span><span class="p">)</span>

        <span class="c1"># 1:&#39;y&#39; 2:&#39;z&#39;</span>
        <span class="k">if</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;Vy&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;Vz&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;My&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;Mz&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_all</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
            <span class="n">dir_plt_tmp</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">dir_plt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dir_plt</span> <span class="o">=</span> <span class="n">dir_plt_tmp</span>

        <span class="n">minVal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">maxVal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">sfac</span>

        <span class="c1"># FIXME - can be simplified</span>
        <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

        <span class="c1"># positive M are opposite to N and V</span>
        <span class="c1"># if sf_type == &#39;Mz&#39; or sf_type == &#39;My&#39;:</span>
        <span class="k">if</span> <span class="n">sf_type</span> <span class="o">==</span> <span class="s1">&#39;Mz&#39;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>

        <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dir_plt</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># plt.axis(&#39;equal&#39;)</span>

        <span class="c1"># section force curve</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_secforce</span><span class="p">,</span>
                 <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                 <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># model</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                 <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span>
                 <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># reference perpendicular lines</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                     <span class="p">[</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                     <span class="p">[</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">fmt_secforce</span><span class="p">,</span>
                     <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                     <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">minVal</span><span class="p">,</span> <span class="n">maxVal</span></div>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>


<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">defo</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">_anim_mode_2d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                  <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span>
                  <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">lw</span><span class="p">):</span>

    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># truss and beam/frame elements</span>
    <span class="k">if</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="n">ndf</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDF</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># truss element</span>
        <span class="k">if</span> <span class="n">ndf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>
                <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

                <span class="c1"># element x, y coordinates</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                    <span class="n">eux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">euy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">euy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="c1"># displaced element coordinates (scaled by sfac factor)</span>
                <span class="n">edx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">eux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">eux</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">edy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">euy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">euy</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edx</span><span class="p">,</span> <span class="n">edy</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">)</span>

        <span class="c1"># beam/frame element anim eigen</span>
        <span class="k">elif</span> <span class="n">ndf</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">nel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">Ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="c1"># time vector for one cycle (period)</span>
            <span class="n">n_cycles</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">n_frames</span> <span class="o">=</span> <span class="n">n_cycles</span> <span class="o">*</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">n_cycles</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
                <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

                <span class="c1"># element x, y coordinates</span>
                <span class="n">Ex</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">Ey</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="n">Ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">2</span><span class="p">]])</span>

                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
                <span class="k">return</span> <span class="n">lines</span>

            <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">interpFlag</span><span class="p">:</span>
                        <span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span> <span class="o">=</span> <span class="n">beam_defo_interp_2d</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">Ey</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">Ed</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                                         <span class="n">nep</span><span class="p">)</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span> <span class="o">=</span> <span class="n">beam_disp_ends</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Ey</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Ed</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                  <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span><span class="p">)</span>

                    <span class="c1"># plt.plot(xcdi, ycdi, fmt_interp)</span>

                <span class="k">return</span> <span class="n">lines</span>

            <span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                                 <span class="n">frames</span><span class="o">=</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># plt.axis(&#39;equal&#39;)</span>
        <span class="c1"># plt.show()  # call this from main py file for more control</span>

    <span class="c1"># 2d triangular elements - todo</span>
    <span class="c1"># elif nen == 3:</span>
    <span class="c1">#     x = ex+sfac*ed[:, [0, 2, 4]]</span>
    <span class="c1">#     y = ex+sfac*ed[:, [1, 3, 5]]</span>
    <span class="c1">#     xc = [x, x[0, :]]</span>
    <span class="c1">#     yc = [x, x[0, :]]</span>

    <span class="c1"># 2d quadrilateral (quad) elements</span>
    <span class="k">elif</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>
            <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span><span class="p">,</span> <span class="n">nd3</span><span class="p">,</span> <span class="n">nd4</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="c1"># element x, y coordinates</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd2</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd3</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd3</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd4</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">nd4</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ey</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="c1"># xcdi, ycdi = beam_defo_interp_2d(ex, ey, ed, sfac, nep)</span>
            <span class="c1"># xdi, ydi = beam_disp_ends(ex, ey, ed, sfac)</span>
            <span class="c1"># # interpolated displacement field</span>
            <span class="c1"># plt.plot(xcdi, ycdi, &#39;b.-&#39;)</span>
            <span class="c1"># # translations of ends only</span>
            <span class="c1"># plt.plot(xdi, ydi, &#39;ro&#39;)</span>

            <span class="c1"># test it with one element</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ex</span><span class="o">+</span><span class="n">sfac</span><span class="o">*</span><span class="n">ed</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ey</span><span class="o">+</span><span class="n">sfac</span><span class="o">*</span><span class="n">ed</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># 2d 8-node quadratic elements</span>
    <span class="c1"># elif nen == 8:</span>
    <span class="c1">#     x = ex+sfac*ed[:, [0, 2, 4, 6, 8, 10, 12, 14]]</span>
    <span class="c1">#     y = ex+sfac*ed[:, [1, 3, 5, 7, 9, 11, 13, 15]]</span>

    <span class="c1">#     t = -1</span>
    <span class="c1">#     n = 0</span>
    <span class="c1">#     for s in range(-1, 1.4, 0.4):</span>
    <span class="c1">#         n += 1</span>
    <span class="c1">#     ...</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Elements not supported yet. nen: </span><span class="si">{</span><span class="n">nen</span><span class="si">}</span><span class="s1">; must be: 2, 3, 4, 8.&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>

    <span class="k">return</span> <span class="n">anim</span>


<div class="viewcode-block" id="anim_mode"><a class="viewcode-back" href="../anim_mode.html#opsvis.anim_mode">[docs]</a><span class="k">def</span> <span class="nf">anim_mode</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="o">=</span><span class="n">fmt_defo</span><span class="p">,</span>
              <span class="n">fmt_undefo</span><span class="o">=</span><span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">fmt_interp</span><span class="o">=</span><span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">Eo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span>
              <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="n">lw</span><span class="o">=</span><span class="mf">3.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make animation of a mode shape obtained from eigenvalue solution.</span>

<span class="sd">    Args:</span>
<span class="sd">        modeNo (int): indicates which mode shape to animate.</span>

<span class="sd">        sfac (float): scale factor</span>

<span class="sd">        nep (integer): number of evaluation points inside the element and</span>
<span class="sd">            including both element ends</span>

<span class="sd">        unDefoFlag (integer): 1 - plot the undeformed model (mesh), 0 - do not</span>
<span class="sd">            plot the mesh</span>

<span class="sd">        interpFlag (integer): 1 - interpolate deformation inside element,</span>
<span class="sd">            0 - no interpolation</span>

<span class="sd">        endDispFlag (integer): 1 - plot marks at element ends, 0 - no marks</span>

<span class="sd">        fmt_interp (string): format line string for interpolated (continuous)</span>
<span class="sd">            deformated shape. The format contains information on line color,</span>
<span class="sd">            style and marks as in the standard matplotlib plot function.</span>

<span class="sd">        fmt_nodes (string): format string for the marks of element ends</span>

<span class="sd">        az_el (tuple): a tuple containing the azimuth and elevation</span>

<span class="sd">        fig_lbrt (tuple): a tuple contating left, bottom, right and top offsets</span>

<span class="sd">        fig_wi_he (tuple): contains width and height of the figure</span>

<span class="sd">    Returns:</span>
<span class="sd">        anim: anim object</span>

<span class="sd">    Notes:</span>

<span class="sd">    See also:</span>
<span class="sd">        anim_mode()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="c1"># calculate sfac</span>
    <span class="c1"># min_x, min_y, min_z = np.inf, np.inf, np.inf</span>
    <span class="c1"># max_x, max_y, max_z = -np.inf, -np.inf, -np.inf</span>
    <span class="c1"># max_ux, max_uy, max_uz = -np.inf, -np.inf, -np.inf</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
                <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ux</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">uy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_ux</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ux</span><span class="p">))</span>
                <span class="n">max_uy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uy</span><span class="p">))</span>

            <span class="n">dxmax</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">dymax</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">dlmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dxmax</span><span class="p">,</span> <span class="n">dymax</span><span class="p">)</span>
            <span class="n">edmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">)</span>
            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">dlmax</span><span class="o">/</span><span class="n">edmax</span>

        <span class="n">anim</span> <span class="o">=</span> <span class="n">_anim_mode_2d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span>
                             <span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span>
                             <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">lw</span><span class="p">)</span>

    <span class="c1"># elif ndim == 3:</span>
    <span class="c1">#     if not sfac:</span>
    <span class="c1">#         for node_tag in node_tags:</span>
    <span class="c1">#             x_crd = ops.nodeCoord(node_tag)[0]</span>
    <span class="c1">#             y_crd = ops.nodeCoord(node_tag)[1]</span>
    <span class="c1">#             z_crd = ops.nodeCoord(node_tag)[2]</span>
    <span class="c1">#             ux = ops.nodeEigenvector(node_tag, modeNo)[0]</span>
    <span class="c1">#             uy = ops.nodeEigenvector(node_tag, modeNo)[1]</span>
    <span class="c1">#             uz = ops.nodeEigenvector(node_tag, modeNo)[2]</span>

    <span class="c1">#             min_x = min(min_x, x_crd)</span>
    <span class="c1">#             min_y = min(min_y, y_crd)</span>
    <span class="c1">#             min_z = min(min_z, z_crd)</span>
    <span class="c1">#             max_x = max(max_x, x_crd)</span>
    <span class="c1">#             max_y = max(max_y, y_crd)</span>
    <span class="c1">#             max_z = max(max_z, z_crd)</span>
    <span class="c1">#             max_ux = max(max_ux, np.abs(ux))</span>
    <span class="c1">#             max_uy = max(max_uy, np.abs(uy))</span>
    <span class="c1">#             max_uz = max(max_uz, np.abs(uz))</span>

    <span class="c1">#         dxmax = max_x - min_x</span>
    <span class="c1">#         dymax = max_y - min_y</span>
    <span class="c1">#         dzmax = max_z - min_z</span>
    <span class="c1">#         dlmax = max(dxmax, dymax, dzmax)</span>
    <span class="c1">#         edmax = max(max_ux, max_uy, max_uz)</span>
    <span class="c1">#         sfac = ratio * dlmax/edmax</span>

    <span class="c1">#     _plot_defo_mode_3d(modeNo, sfac, nep, unDefoFlag, fmt_defo,</span>
    <span class="c1">#                        fmt_undefo, interpFlag, endDispFlag, fmt_interp,</span>
    <span class="c1">#                         fmt_nodes, Eo, az_el, fig_wi_he, fig_lbrt)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">anim</span></div>


<span class="k">def</span> <span class="nf">_anim_defo_2d</span><span class="p">(</span><span class="n">Eds</span><span class="p">,</span> <span class="n">timeV</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                  <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span>
                  <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">):</span>

    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># truss and beam/frame elements</span>
    <span class="k">if</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="n">ndf</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDF</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># truss element</span>
        <span class="k">if</span> <span class="n">ndf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>
                <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

                <span class="c1"># element x, y coordinates</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="n">eux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">euy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="c1"># displaced element coordinates (scaled by sfac factor)</span>
                <span class="n">edx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">eux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">eux</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">edy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">euy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">euy</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edx</span><span class="p">,</span> <span class="n">edy</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">)</span>

        <span class="c1"># beam/frame element anim defo</span>
        <span class="k">elif</span> <span class="n">ndf</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># ax.grid()</span>

            <span class="n">nel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="c1"># no of frames equal to time intervals</span>
            <span class="n">n_frames</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Eds</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># time_text = ax.set_title(&#39;&#39;)  # does not work</span>
            <span class="n">time_text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.95</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
                <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

                <span class="c1"># element x, y coordinates</span>
                <span class="n">Ex</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">Ey</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>

                <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">time_text</span><span class="p">,)</span>

            <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">interpFlag</span><span class="p">:</span>
                        <span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span> <span class="o">=</span> <span class="n">beam_defo_interp_2d</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">Ey</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">Eds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                         <span class="n">sfac</span><span class="p">,</span>
                                                         <span class="n">nep</span><span class="p">)</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span> <span class="o">=</span> <span class="n">beam_disp_ends</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Ey</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
                                                  <span class="n">Eds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sfac</span><span class="p">)</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span><span class="p">)</span>

                    <span class="c1"># plt.plot(xcdi, ycdi, fmt_interp)</span>

                <span class="c1"># time_text.set_text(f&#39;f&#39;)</span>
                <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;frame: </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s1">, </span><span class="se">\</span>
<span class="s1">time: </span><span class="si">{</span><span class="n">timeV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">time_text</span><span class="p">,)</span>

            <span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">n_frames</span><span class="p">,</span>
                                 <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># plt.axis(&#39;equal&#39;)</span>
        <span class="c1"># plt.show()  # call this from main py file for more control</span>

    <span class="c1"># 2d triangular elements</span>
    <span class="c1"># elif nen == 3:</span>
    <span class="c1">#     x = ex+sfac*ed[:, [0, 2, 4]]</span>
    <span class="c1">#     y = ex+sfac*ed[:, [1, 3, 5]]</span>
    <span class="c1">#     xc = [x, x[0, :]]</span>
    <span class="c1">#     yc = [x, x[0, :]]</span>

    <span class="c1"># 2d quadrilateral (quad) elements</span>
    <span class="k">elif</span> <span class="n">nen</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>
            <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span><span class="p">,</span> <span class="n">nd3</span><span class="p">,</span> <span class="n">nd4</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="c1"># element x, y coordinates</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="c1"># if modeNo:</span>
            <span class="c1">#     ed = np.array([ops.nodeEigenvector(nd1, modeNo)[0],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd1, modeNo)[1],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd2, modeNo)[0],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd2, modeNo)[1],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd3, modeNo)[0],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd3, modeNo)[1],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd4, modeNo)[0],</span>
            <span class="c1">#                    ops.nodeEigenvector(nd4, modeNo)[1]])</span>
            <span class="c1"># else:</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">nd4</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ey</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="c1"># xcdi, ycdi = beam_defo_interp_2d(ex, ey, ed, sfac, nep)</span>
            <span class="c1"># xdi, ydi = beam_disp_ends(ex, ey, ed, sfac)</span>
            <span class="c1"># # interpolated displacement field</span>
            <span class="c1"># plt.plot(xcdi, ycdi, &#39;b.-&#39;)</span>
            <span class="c1"># # translations of ends only</span>
            <span class="c1"># plt.plot(xdi, ydi, &#39;ro&#39;)</span>

            <span class="c1"># test it with one element</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ex</span><span class="o">+</span><span class="n">sfac</span><span class="o">*</span><span class="n">ed</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ey</span><span class="o">+</span><span class="n">sfac</span><span class="o">*</span><span class="n">ed</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># 2d 8-node quadratic elements</span>
    <span class="c1"># elif nen == 8:</span>
    <span class="c1">#     x = ex+sfac*ed[:, [0, 2, 4, 6, 8, 10, 12, 14]]</span>
    <span class="c1">#     y = ex+sfac*ed[:, [1, 3, 5, 7, 9, 11, 13, 15]]</span>

    <span class="c1">#     t = -1</span>
    <span class="c1">#     n = 0</span>
    <span class="c1">#     for s in range(-1, 1.4, 0.4):</span>
    <span class="c1">#         n += 1</span>
    <span class="c1">#     ...</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Elements not supported yet. nen: </span><span class="si">{</span><span class="n">nen</span><span class="si">}</span><span class="s1">; must be: 2, 3, 4, 8.&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>

    <span class="k">return</span> <span class="n">anim</span>


<div class="viewcode-block" id="anim_defo"><a class="viewcode-back" href="../anim_defo.html#opsvis.anim_defo">[docs]</a><span class="k">def</span> <span class="nf">anim_defo</span><span class="p">(</span><span class="n">Eds</span><span class="p">,</span> <span class="n">timeV</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="o">=</span><span class="n">fmt_defo</span><span class="p">,</span>
              <span class="n">fmt_undefo</span><span class="o">=</span><span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">fmt_interp</span><span class="o">=</span><span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span>
              <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Make animation of the deformed shape computed by transient analysis</span>

<span class="sd">    Args:</span>
<span class="sd">        Eds (ndarray): A 3d array (n_steps x n_eles x n_dof_per_element)</span>
<span class="sd">            containing the collected displacements per element for all</span>
<span class="sd">            time steps.</span>

<span class="sd">        timeV (1darray): vector of discretized time values</span>

<span class="sd">        sfac (float): scale factor</span>

<span class="sd">        nep (integer): number of evaluation points inside the element and</span>
<span class="sd">            including both element ends</span>

<span class="sd">        unDefoFlag (integer): 1 - plot the undeformed model (mesh), 0 - do not</span>
<span class="sd">            plot the mesh</span>

<span class="sd">        interpFlag (integer): 1 - interpolate deformation inside element,</span>
<span class="sd">            0 - no interpolation</span>

<span class="sd">        endDispFlag (integer): 1 - plot marks at element ends, 0 - no marks</span>

<span class="sd">        fmt_interp (string): format line string for interpolated (continuous)</span>
<span class="sd">            deformated shape. The format contains information on line color,</span>
<span class="sd">            style and marks as in the standard matplotlib plot function.</span>

<span class="sd">        fmt_nodes (string): format string for the marks of element ends</span>

<span class="sd">        az_el (tuple): a tuple containing the azimuth and elevation</span>

<span class="sd">        fig_lbrt (tuple): a tuple contating left, bottom, right and top offsets</span>

<span class="sd">        fig_wi_he (tuple): contains width and height of the figure</span>

<span class="sd">    Examples:</span>

<span class="sd">    Notes:</span>

<span class="sd">    See also:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">_anim_defo_2d</span><span class="p">(</span><span class="n">Eds</span><span class="p">,</span> <span class="n">timeV</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span>
                             <span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span>
                             <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">anim</span></div>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>


<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="k">def</span> <span class="nf">_plot_defo_mode_2d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                       <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">):</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>
            <span class="c1"># nd1, nd2 = ops.eleNodes(ele_tag)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># displaced element coordinates (scaled by sfac factor)</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_interp</span><span class="p">)</span>

        <span class="c1"># beam/frame element plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam2d</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn2d</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn2d</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="c1"># interpolated displacement field</span>
            <span class="k">if</span> <span class="n">interpFlag</span><span class="p">:</span>
                <span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span> <span class="o">=</span> <span class="n">beam_defo_interp_2d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                                 <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span> <span class="o">=</span> <span class="n">beam_disp_ends</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xcdi</span><span class="p">,</span> <span class="n">ycdi</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">)</span>

            <span class="c1"># translations of ends</span>
            <span class="k">if</span> <span class="n">endDispFlag</span><span class="p">:</span>
                <span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span> <span class="o">=</span> <span class="n">beam_disp_ends</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                          <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdi</span><span class="p">,</span> <span class="n">ydi</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">)</span>

        <span class="c1"># 2d triangular (tri31) elements plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">fmt_defo</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad) elements plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">fmt_defo</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad8n) elements plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">fmt_defo</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad9n) elements plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">fmt_defo</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xy</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">xy</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

        <span class="c1"># 2d triangle (tri6n) elements plot_defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xy</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">xy</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">fmt_defo</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Elements not supported yet. nen: </span><span class="si">{</span><span class="n">nen</span><span class="si">}</span><span class="s1">; must be: 2, 3, 4, 8.&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_plot_defo_mode_3d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                       <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">az_el</span><span class="p">,</span>
                       <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">):</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>
    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.985</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.94</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># ax.axis(&#39;equal&#39;)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># if (ele_classtag == EleClassTag.truss):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn3d</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># eo = Eo[i, :]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">),</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">),</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">interpFlag</span><span class="p">:</span>
                <span class="c1"># xcd, ycd, zcd = beam_defo_interp_3d(ex, ey, ez, g,</span>
                <span class="c1">#                                     ed, sfac, nep)</span>
                <span class="n">xcd</span><span class="p">,</span> <span class="n">ycd</span><span class="p">,</span> <span class="n">zcd</span> <span class="o">=</span> <span class="n">beam_defo_interp_3d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">g</span><span class="p">,</span>
                                                    <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xcd</span><span class="p">,</span> <span class="n">ycd</span><span class="p">,</span> <span class="n">zcd</span> <span class="o">=</span> <span class="n">beam_disp_ends3d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                                 <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                                                 <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xcd</span><span class="p">,</span> <span class="n">ycd</span><span class="p">,</span> <span class="n">zcd</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

            <span class="c1"># translations of ends</span>
            <span class="k">if</span> <span class="n">endDispFlag</span><span class="p">:</span>
                <span class="n">xd</span><span class="p">,</span> <span class="n">yd</span><span class="p">,</span> <span class="n">zd</span> <span class="o">=</span> <span class="n">beam_disp_ends3d</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                              <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                                              <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sfac</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">yd</span><span class="p">,</span> <span class="n">zd</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">)</span>

        <span class="c1"># plot: shell in 3d</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellMITC4</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ASDShellQ4</span><span class="p">):</span>

            <span class="c1"># ndf is limited to translations x, y, z (no rotations)</span>
            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>  <span class="c1"># without rotations</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>
            <span class="c1"># x = ex+sfac*ed[[0, 3, 6, 9]]</span>
            <span class="c1"># y = ey+sfac*ed[[1, 4, 7, 10]]</span>
            <span class="c1"># z = ez+sfac*ed[[2, 5, 8, 11]]</span>

            <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">Poly3DCollection</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                 <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                                 <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># 4-node tetrahedron, 3d defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">FourNodeTetrahedron</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span>
                         <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="c1"># tetra10n, 3d defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TenNodeTetrahedron</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="c1"># 8-node brick, 3d defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick8n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bottom face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">fmt_undefo</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_defo</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_defo</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_defo</span><span class="p">)</span>

        <span class="c1"># plot: quad in 3d defo, but also shell which case more dofs</span>
        <span class="c1"># elif (ele_classtag == EleClassTag.quad4n):</span>

        <span class="c1"># 20-node brick20n, 3d defo</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick20n</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># bottom face nodes loop</span>
            <span class="n">nodes_geo_order2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># top face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">modeNo</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unDefoFlag</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">fmt_undefo</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_undefo</span><span class="p">)</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">ecrd</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">ed</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xyz</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_zlim3d</span><span class="p">())))</span>


<span class="k">def</span> <span class="nf">plot_defo</span><span class="p">(</span><span class="n">sfac</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="o">=</span><span class="n">fmt_defo</span><span class="p">,</span>
              <span class="n">fmt_undefo</span><span class="o">=</span><span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">fmt_interp</span><span class="o">=</span><span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="o">=</span><span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">Eo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span>
              <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot deformed shape of the structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        sfac (float): scale factor to increase/decrease displacements obtained</span>
<span class="sd">            from FE analysis. If not specified (False), sfac is automatically</span>
<span class="sd">            calculated based on the maximum overall displacement and this</span>
<span class="sd">            maximum displacement is plotted as 20 percent (hordcoded) of</span>
<span class="sd">            the maximum model dimension.</span>

<span class="sd">        interpFlag (int): 1 - use interpolated deformation using shape</span>
<span class="sd">            function, 0 - do not use interpolation, just show displaced element</span>
<span class="sd">            nodes (default is 1)</span>

<span class="sd">        nep (int): number of evaluation points for shape function interpolation</span>
<span class="sd">            (default: 17)</span>

<span class="sd">    Returns:</span>
<span class="sd">        sfac (float): the automatically calculated scale factor can be</span>
<span class="sd">            returned.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ``sfac = plot_defo()`` - plot deformed shape with default parameters and</span>
<span class="sd">    automatically calcutated scale factor.</span>

<span class="sd">    ``plot_defo(interpFlag=0)`` - plot simplified deformation by</span>
<span class="sd">    displacing the nodes connected with straight lines (shape function</span>
<span class="sd">    interpolation)</span>

<span class="sd">    ``plot_defo(sfac=1.5)`` - plot with specified scale factor</span>

<span class="sd">    ``plot_defo(unDefoFlag=0, endDispFlag=0)`` - plot without showing</span>
<span class="sd">    undeformed (original) mesh and without showing markers at the</span>
<span class="sd">    element ends.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="c1"># calculate sfac</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">min_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">max_z</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">,</span> <span class="n">max_uz</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
                <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ux</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">uy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_ux</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ux</span><span class="p">))</span>
                <span class="n">max_uy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uy</span><span class="p">))</span>

            <span class="n">dxmax</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">dymax</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">dlmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dxmax</span><span class="p">,</span> <span class="n">dymax</span><span class="p">)</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">max_u_abs</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">max_u_abs</span> <span class="o">=</span> <span class="n">max_u_abs_from_beam_defo_interp_2d</span><span class="p">(</span><span class="n">nep</span><span class="o">=</span><span class="n">nep</span><span class="p">)</span>

            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">dlmax</span><span class="o">/</span><span class="n">max_u_abs</span>

        <span class="n">_plot_defo_mode_2d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                           <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span>
                           <span class="n">fmt_nodes</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
                <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ux</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">uy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">uz</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

                <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">min_z</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_z</span><span class="p">,</span> <span class="n">z_crd</span><span class="p">)</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_z</span><span class="p">,</span> <span class="n">z_crd</span><span class="p">)</span>
                <span class="n">max_ux</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ux</span><span class="p">))</span>
                <span class="n">max_uy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uy</span><span class="p">))</span>
                <span class="n">max_uz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uz</span><span class="p">))</span>

            <span class="n">dxmax</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">dymax</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">dzmax</span> <span class="o">=</span> <span class="n">max_z</span> <span class="o">-</span> <span class="n">min_z</span>
            <span class="n">dlmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dxmax</span><span class="p">,</span> <span class="n">dymax</span><span class="p">,</span> <span class="n">dzmax</span><span class="p">)</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">,</span> <span class="n">max_uz</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">max_u_abs</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">max_u_abs</span> <span class="o">=</span> <span class="n">max_u_abs_from_beam_defo_interp_3d</span><span class="p">(</span><span class="n">nep</span><span class="o">=</span><span class="n">nep</span><span class="p">)</span>

            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">dlmax</span><span class="o">/</span><span class="n">max_u_abs</span>

        <span class="n">_plot_defo_mode_3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                           <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span>
                           <span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sfac</span>


<span class="k">def</span> <span class="nf">plot_mode_shape</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">fmt_undefo</span><span class="o">=</span><span class="n">fmt_undefo</span><span class="p">,</span> <span class="n">interpFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">fmt_interp</span><span class="o">=</span><span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="o">=</span><span class="n">fmt_nodes</span><span class="p">,</span> <span class="n">Eo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot mode shape of the structure obtained from eigenvalue analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        modeNo (int): indicates which mode shape to plot</span>

<span class="sd">        sfac (float): scale factor to increase/decrease displacements obtained</span>
<span class="sd">            from FE analysis. If not specified (False), sfac is automatically</span>
<span class="sd">            calculated based on the maximum overall displacement and this</span>
<span class="sd">            maximum displacement is plotted as 20 percent (hordcoded) of</span>
<span class="sd">            the maximum model dimension.</span>

<span class="sd">        interpFlag (int): 1 - use interpolated deformation using shape</span>
<span class="sd">            function, 0 - do not use interpolation, just show displaced element</span>
<span class="sd">            nodes (default is 1)</span>

<span class="sd">        nep (int): number of evaluation points for shape function interpolation</span>
<span class="sd">            (default: 17)</span>

<span class="sd">    Usage:</span>

<span class="sd">    ``plot_mode_shape(1)`` - plot the first mode shape with default parameters</span>
<span class="sd">    and automatically calcutated scale factor.</span>

<span class="sd">    ``plot_mode_shape(2, interpFlag=0)`` - plot the 2nd mode shape by</span>
<span class="sd">    displacing the nodes connected with straight lines (shape function</span>
<span class="sd">    interpolation)</span>

<span class="sd">    ``plot_mode_shape(3, sfac=1.5)`` - plot the 3rd mode shape with specified</span>
<span class="sd">    scale factor</span>

<span class="sd">    ``plot_mode_shape(4, unDefoFlag=0, endDispFlag=0)`` - plot the 4th mode</span>
<span class="sd">    shape without showing undeformed (original) mesh and without showing</span>
<span class="sd">    markers at the element ends.</span>

<span class="sd">    Examples:</span>

<span class="sd">    Notes:</span>

<span class="sd">    See also:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="c1"># calculate sfac</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">min_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">max_z</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">,</span> <span class="n">max_uz</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
                <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ux</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">uy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_ux</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ux</span><span class="p">))</span>
                <span class="n">max_uy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uy</span><span class="p">))</span>

            <span class="n">dxmax</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">dymax</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">dlmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dxmax</span><span class="p">,</span> <span class="n">dymax</span><span class="p">)</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">)</span>
            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">dlmax</span><span class="o">/</span><span class="n">max_u_abs</span>

        <span class="n">_plot_defo_mode_2d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                           <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
                <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ux</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">uy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">uz</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeEigenvector</span><span class="p">(</span><span class="n">node_tag</span><span class="p">,</span> <span class="n">modeNo</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

                <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">min_z</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_z</span><span class="p">,</span> <span class="n">z_crd</span><span class="p">)</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">x_crd</span><span class="p">)</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">,</span> <span class="n">y_crd</span><span class="p">)</span>
                <span class="n">max_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_z</span><span class="p">,</span> <span class="n">z_crd</span><span class="p">)</span>
                <span class="n">max_ux</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ux</span><span class="p">))</span>
                <span class="n">max_uy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uy</span><span class="p">))</span>
                <span class="n">max_uz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_uz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uz</span><span class="p">))</span>

            <span class="n">dxmax</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">dymax</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">dzmax</span> <span class="o">=</span> <span class="n">max_z</span> <span class="o">-</span> <span class="n">min_z</span>
            <span class="n">dlmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dxmax</span><span class="p">,</span> <span class="n">dymax</span><span class="p">,</span> <span class="n">dzmax</span><span class="p">)</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ux</span><span class="p">,</span> <span class="n">max_uy</span><span class="p">,</span> <span class="n">max_uz</span><span class="p">)</span>
            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">dlmax</span><span class="o">/</span><span class="n">max_u_abs</span>

        <span class="n">_plot_defo_mode_3d</span><span class="p">(</span><span class="n">modeNo</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">,</span> <span class="n">unDefoFlag</span><span class="p">,</span> <span class="n">fmt_defo</span><span class="p">,</span> <span class="n">fmt_undefo</span><span class="p">,</span>
                           <span class="n">interpFlag</span><span class="p">,</span> <span class="n">endDispFlag</span><span class="p">,</span> <span class="n">fmt_interp</span><span class="p">,</span> <span class="n">fmt_nodes</span><span class="p">,</span>
                           <span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([[</span><span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span>


<span class="k">def</span> <span class="nf">rot_transf_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">):</span>

    <span class="n">Lxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>
    <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">Lxy</span> <span class="o">/</span> <span class="n">L</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cosa</span><span class="p">,</span>  <span class="n">cosb</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">cosb</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span>  <span class="n">cosb</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">cosb</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span>


<span class="k">def</span> <span class="nf">beam_disp_ends</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sfac</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the element deformation at element ends only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#  indx: 0   1   2   3   4   5</span>
    <span class="c1"># Ed = ux1 uy1 ur1 ux2 uy2 ur2</span>
    <span class="n">exd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
    <span class="n">eyd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">exd</span><span class="p">,</span> <span class="n">eyd</span>


<span class="k">def</span> <span class="nf">beam_defo_interp_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate element displacements at nep points.</span>

<span class="sd">    Parametrs:</span>
<span class="sd">    ex, ey : element x, y coordinates,</span>
<span class="sd">    u : element nodal displacements</span>
<span class="sd">    sfac : scale factor for deformation plot</span>
<span class="sd">    nep : number of evaluation points (including end nodes)</span>

<span class="sd">    Returns:</span>
<span class="sd">    crd_xc, crd_yc : x, y coordinates of interpolated (at nep points)</span>
<span class="sd">    beam deformation required for plot_defo() function</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">rot_transf_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">)</span>

    <span class="n">u_l</span> <span class="o">=</span> <span class="n">G</span> <span class="o">@</span> <span class="n">u</span>

    <span class="c1"># longitudinal deformation (1)</span>
    <span class="n">N_a</span> <span class="o">=</span> <span class="n">beam_axial_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
    <span class="n">u_ac</span> <span class="o">=</span> <span class="n">N_a</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

    <span class="c1"># transverse deformation (2)</span>
    <span class="n">N_t</span> <span class="o">=</span> <span class="n">beam_transverse_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
    <span class="n">u_tc</span> <span class="o">=</span> <span class="n">N_t</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
    <span class="c1"># for u_tci in u_tc:</span>

    <span class="c1"># combined two row vectors</span>
    <span class="c1"># 1-st vector longitudinal deformation (1)</span>
    <span class="c1"># 2-nd vector transverse deformation (2)</span>
    <span class="n">u_atc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">u_ac</span><span class="p">,</span> <span class="n">u_tc</span><span class="p">))</span>

    <span class="c1"># project longitudinal (u_ac) and transverse deformation</span>
    <span class="c1"># (local u and v) to (global u and v)</span>
    <span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cosa</span><span class="p">,</span> <span class="o">-</span><span class="n">cosb</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">cosb</span><span class="p">,</span> <span class="n">cosa</span><span class="p">]])</span>

    <span class="n">u_xyc</span> <span class="o">=</span> <span class="n">G1</span> <span class="o">@</span> <span class="n">u_atc</span>

    <span class="c1"># discretize element coordinates</span>
    <span class="c1"># first  row = X + [0 dx 2dx ... 4-dx 4]</span>
    <span class="c1"># second row = Y + [0 dy 2dy ... 3-dy 3]</span>
    <span class="n">xy_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">)))</span>

    <span class="c1"># Continuous x, y displacement coordinates</span>
    <span class="n">crd_xc</span> <span class="o">=</span> <span class="n">xy_c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">u_xyc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">crd_yc</span> <span class="o">=</span> <span class="n">xy_c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">u_xyc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1"># latex_array(ecrd_xc)</span>
    <span class="c1"># latex_array(ecrd_yc)</span>

    <span class="k">return</span> <span class="n">crd_xc</span><span class="p">,</span> <span class="n">crd_yc</span>


<span class="k">def</span> <span class="nf">beam_disp_ends3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sfac</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the element deformation at element ends only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#  indx: 0   1   2   3   4   5   6   7   8   9  10  11</span>
    <span class="c1"># Ed = ux1 uy1 uz1 rx1 ry1 rz1 ux2 uy2 uz2 rx2 ry2 rz2</span>
    <span class="n">exd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
    <span class="n">eyd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">7</span><span class="p">]])</span>
    <span class="n">ezd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sfac</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">8</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">exd</span><span class="p">,</span> <span class="n">eyd</span><span class="p">,</span> <span class="n">ezd</span>


<span class="k">def</span> <span class="nf">beam_defo_interp_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3d beam version of beam_defo_interp_2d.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">ul</span> <span class="o">=</span> <span class="n">G</span> <span class="o">@</span> <span class="n">u</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">crd_yc</span> <span class="o">=</span> <span class="n">beam_defo_interp_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">]),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                              <span class="n">ul</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">11</span><span class="p">]]),</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
    <span class="n">crd_xc</span><span class="p">,</span> <span class="n">crd_zc</span> <span class="o">=</span> <span class="n">beam_defo_interp_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">]),</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">ul</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                                   <span class="n">ul</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="o">-</span><span class="n">ul</span><span class="p">[</span><span class="mi">10</span><span class="p">]]),</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">)</span>
    <span class="n">crd_xc</span> <span class="o">=</span> <span class="n">crd_xc</span> <span class="o">-</span> <span class="n">xl</span>

    <span class="n">crd_xyzc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">crd_xc</span><span class="p">,</span> <span class="n">crd_yc</span><span class="p">,</span> <span class="n">crd_zc</span><span class="p">])</span>

    <span class="n">u_xyzc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">@</span> <span class="n">crd_xyzc</span>

    <span class="n">xyz_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">)))</span>

    <span class="n">crd_xc</span> <span class="o">=</span> <span class="n">xyz_c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">u_xyzc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">crd_yc</span> <span class="o">=</span> <span class="n">xyz_c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">u_xyzc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">crd_zc</span> <span class="o">=</span> <span class="n">xyz_c</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">u_xyzc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">crd_xc</span><span class="p">,</span> <span class="n">crd_yc</span><span class="p">,</span> <span class="n">crd_zc</span>


<span class="k">def</span> <span class="nf">max_u_abs_from_beam_defo_interp_2d</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find maximum displacement from the interpolated tranverse deformation.</span>

<span class="sd">    Useful if the translational nodal displacement are small and transverse</span>
<span class="sd">    deformation is due to nodal rotations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_u_abs</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn2d</span><span class="p">):</span>

            <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ex</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">ey</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">rot_transf_2d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">)</span>

            <span class="n">u_l</span> <span class="o">=</span> <span class="n">G</span> <span class="o">@</span> <span class="n">u</span>

            <span class="n">N_t</span> <span class="o">=</span> <span class="n">beam_transverse_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>

            <span class="n">u_tc</span> <span class="o">=</span> <span class="n">N_t</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">u_l</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>

            <span class="n">max_u_tc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_tc</span><span class="p">))</span>

            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_u_abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_u_tc</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">max_u_abs</span>


<span class="k">def</span> <span class="nf">max_u_abs_from_beam_defo_interp_3d</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find maximum displacement from the interpolated tranverse deformation.</span>

<span class="sd">    Useful if the translational nodal displacement are small and transverse</span>
<span class="sd">    deformation is due to nodal rotations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span>

    <span class="n">max_u_abs</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn3d</span><span class="p">):</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">),</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">),</span>
                           <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)))</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="n">ndf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDisp</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ex</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">ey</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">ez</span> <span class="o">=</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">G</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
            <span class="n">ul</span> <span class="o">=</span> <span class="n">G</span> <span class="o">@</span> <span class="n">u</span>

            <span class="n">N_t</span> <span class="o">=</span> <span class="n">beam_transverse_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>

            <span class="c1"># account for two cross section axis</span>
            <span class="c1"># (1) first cross section axis</span>
            <span class="n">u_tc</span> <span class="o">=</span> <span class="n">N_t</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">11</span><span class="p">]])</span>
            <span class="n">max_u_tc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_tc</span><span class="p">))</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_u_abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_u_tc</span><span class="p">))</span>


            <span class="c1"># (2) second cross section axis</span>
            <span class="n">u_tc</span> <span class="o">=</span> <span class="n">N_t</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">ul</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ul</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="o">-</span><span class="n">ul</span><span class="p">[</span><span class="mi">10</span><span class="p">]])</span>
            <span class="n">max_u_tc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_tc</span><span class="p">))</span>
            <span class="n">max_u_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_u_abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_u_tc</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">max_u_abs</span>


<span class="k">def</span> <span class="nf">beam_transverse_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">):</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xl</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">N_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">one</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                           <span class="n">xl</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">xl</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                           <span class="mi">3</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xl</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                           <span class="o">-</span><span class="n">xl</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">xl</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">N_t</span>


<span class="k">def</span> <span class="nf">beam_axial_shape_functions</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">):</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nep</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xl</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">N_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">one</span> <span class="o">-</span> <span class="n">xl</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="n">xl</span><span class="o">/</span><span class="n">L</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">N_a</span>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>

<span class="c1"># Notes:</span>

<span class="c1"># 1. matplotlib&#39;s plt.axis(&#39;equal&#39;) does not work for 3d plots</span>
<span class="c1">#    therefore right angles are not guaranteed to be 90 degrees on the</span>
<span class="c1">#    plots</span>


<span class="kn">from</span> <span class="nn">importing_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">defo</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">_plot_model_2d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span>
                   <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span> <span class="n">fmt_model</span><span class="p">):</span>

    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.985</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.94</span><span class="p">)</span>

    <span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_crd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="c1"># nodes only in the OpenSees domain</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">nodes_only</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x_crd</span> <span class="o">&gt;</span> <span class="n">max_x_crd</span><span class="p">:</span>
            <span class="n">max_x_crd</span> <span class="o">=</span> <span class="n">x_crd</span>
        <span class="k">if</span> <span class="n">y_crd</span> <span class="o">&gt;</span> <span class="n">max_y_crd</span><span class="p">:</span>
            <span class="n">max_y_crd</span> <span class="o">=</span> <span class="n">y_crd</span>

    <span class="n">max_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">])</span>
    <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">max_crd</span>
    <span class="n">_offnl</span> <span class="o">=</span> <span class="mf">0.003</span> <span class="o">*</span> <span class="n">max_crd</span>

    <span class="c1"># 0. first print node labels</span>
    <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_tags</span><span class="p">):</span>
            <span class="c1"># xycrd = ops.nodeCoord(node_tag)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="s1">&#39;above&#39;</span><span class="p">:</span>
                <span class="n">offset_nd_label_x</span><span class="p">,</span> <span class="n">offset_nd_label_y</span> <span class="o">=</span> <span class="n">_offnl</span><span class="p">,</span> <span class="n">_offnl</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                <span class="c1"># va = &#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offset_nd_label_x</span><span class="p">,</span> <span class="n">offset_nd_label_y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offnl</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset_nd_label_x</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset_nd_label_y</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TimoshenkoBeamColumn2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticTimoshenkoBeam2d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d triangular (tri31) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri3n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad8n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad8n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># 2d quadrilateral (quad9n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad9n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">9</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="c1"># 2d triangle (tri6n) elements plot_model</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">tri6n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">_plot_model_3d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span>
                   <span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">local_axes</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span>
                   <span class="n">fmt_model</span><span class="p">):</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>

    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.985</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.94</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_z_crd</span><span class="p">,</span> <span class="n">max_crd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> \
        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># nodes only in the OpenSees domain</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">nodes_only</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">x_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x_crd</span> <span class="o">&gt;</span> <span class="n">max_x_crd</span><span class="p">:</span>
            <span class="n">max_x_crd</span> <span class="o">=</span> <span class="n">x_crd</span>
        <span class="k">if</span> <span class="n">y_crd</span> <span class="o">&gt;</span> <span class="n">max_y_crd</span><span class="p">:</span>
            <span class="n">max_y_crd</span> <span class="o">=</span> <span class="n">y_crd</span>
        <span class="k">if</span> <span class="n">z_crd</span> <span class="o">&gt;</span> <span class="n">max_z_crd</span><span class="p">:</span>
            <span class="n">max_z_crd</span> <span class="o">=</span> <span class="n">z_crd</span>

    <span class="k">if</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">offset_nd_label</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_crd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">max_x_crd</span><span class="p">,</span> <span class="n">max_y_crd</span><span class="p">,</span> <span class="n">max_z_crd</span><span class="p">])</span>
        <span class="n">_offset</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">max_crd</span>

    <span class="k">if</span> <span class="n">node_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">_offset</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">_offset</span><span class="p">,</span>
                    <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">_offset</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>
        <span class="n">ele_classtag</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleClassTags</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ForceBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">DispBeamColumn3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ElasticTimoshenkoBeam3d</span> <span class="ow">or</span>
            <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">truss</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">)</span>

            <span class="c1"># fixme: placement of node_tag labels</span>
            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">local_axes</span><span class="p">:</span>
                <span class="c1"># eo = Eo[i, :]</span>
                <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
                <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
                <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">bar_length</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">alen</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">L</span>

                <span class="c1"># plot local axis directional vectors: workaround quiver = arrow</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                           <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                           <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                           <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># quad in 3d</span>
        <span class="c1"># elif nen == 4:</span>
        <span class="k">elif</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">FourNodeTetrahedron</span><span class="p">:</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="k">elif</span> <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">TenNodeTetrahedron</span><span class="p">:</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ShellMITC4</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">ASDShellQ4</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">quad4n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="c1"># 8-node brick, 3d model</span>
        <span class="c1"># elif nen == 8:</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick8n</span> <span class="ow">or</span>
              <span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">SSPbrick</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bottom face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

        <span class="c1"># 20-node brick, 3d model</span>
        <span class="c1"># elif nen == 20:</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ele_classtag</span> <span class="o">==</span> <span class="n">EleClassTag</span><span class="o">.</span><span class="n">brick20n</span><span class="p">):</span>

            <span class="n">nen</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">nodes_geo_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bottom face nodes loop</span>

            <span class="n">ele_node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

            <span class="n">ecrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nen</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_node_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_node_tags</span><span class="p">):</span>
                <span class="n">ecrd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">ele_node_tag</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">ecrd</span><span class="p">[</span><span class="n">nodes_geo_order</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">fmt_model</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="c1"># for j in range(2):</span>
            <span class="c1">#     ax.plot(ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 0],</span>
            <span class="c1">#             ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 1],</span>
            <span class="c1">#             ecrd[[0+j*4, 8+j*4, 1+j*4, 9+j*4, 2+j*4, 10+j*4, 3+j*4, 11+j*4, 0+j*4], 2],</span>
            <span class="c1">#             fmt_model, lw=lw, ms=2, mfc=&#39;g&#39;, mec=&#39;g&#39;)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ecrd</span><span class="p">[[</span><span class="n">j</span><span class="p">,</span> <span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fmt_model</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

            <span class="c1"># location of label</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ecrd</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">nen</span>

            <span class="k">if</span> <span class="n">element_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">ecrd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ecrd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_offset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="o">+</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">yt</span><span class="o">+</span><span class="n">offset_y</span><span class="p">,</span> <span class="n">zt</span><span class="o">+</span><span class="n">offset_z</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ele_tag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1"># if node_labels:</span>
            <span class="c1">#     for node_tag in node_tags:</span>
            <span class="c1">#         ax.text(ops.nodeCoord(node_tag)[0]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[1]+_offset,</span>
            <span class="c1">#                 ops.nodeCoord(node_tag)[2]+_offset,</span>
            <span class="c1">#                 f&#39;{node_tag}&#39;, va=&#39;bottom&#39;, ha=&#39;left&#39;, color=&#39;blue&#39;)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim3d</span><span class="p">()),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_zlim3d</span><span class="p">())))</span>

    <span class="k">return</span> <span class="n">ax</span>


<div class="viewcode-block" id="plot_model"><a class="viewcode-back" href="../plot_model.html#opsvis.plot_model">[docs]</a><span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">element_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">axis_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span>
               <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">local_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nodes_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">fmt_model</span><span class="o">=</span><span class="n">fmt_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot defined model of the structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_labels (int): 1 - plot node labels, 0 - do not plot them;</span>
<span class="sd">            (default: 1)</span>

<span class="sd">        element_labels (int): 1 - plot element labels, 0 - do not plot</span>
<span class="sd">            them; (default: 1)</span>

<span class="sd">        offset_nd_label (bool): False - do not offset node labels from the</span>
<span class="sd">            actual node location. This option can enhance visibility.</span>

<span class="sd">        axis_off (int): 0 - turn off axes, 1 - display axes; (default: 0)</span>

<span class="sd">        az_el (tuple): contains azimuth and elevation for 3d plots. For 2d</span>
<span class="sd">            plots this parameter is neglected.</span>

<span class="sd">        fig_wi_he (tuple): contains width and height of the figure</span>

<span class="sd">        fig_lbrt (tuple): a tuple contating left, bottom, right and top offsets</span>

<span class="sd">        lw (float): the line width of the model</span>

<span class="sd">        local_axes (bool): True - show cross section local axes or False.</span>
<span class="sd">            The green, red and blue arrows denote the element axis direction,</span>
<span class="sd">            the z-local axis and the y-local axis.</span>

<span class="sd">        nodes_only (bool): True - show the nodes only, although the elements</span>
<span class="sd">            are defined. Default: False.</span>

<span class="sd">        fmt_model (string): Default is &#39;b.-&#39; to show both element outline and</span>
<span class="sd">            nodes as markers. To hide nodes use &#39;b-&#39;, for example.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ``plot_model()`` - plot model with node and element labels.</span>

<span class="sd">    ``plot_model(node_labels=0, element_labels=0)`` - plot model without node</span>
<span class="sd">    element labels</span>

<span class="sd">    ``plot_model(fig_wi_he=(20., 14.))`` - plot model in a window 20 cm long,</span>
<span class="sd">    and 14 cm high.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># az_el - azimut, elevation used for 3d plots only</span>
    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>

    <span class="n">ndim</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDM</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_model_2d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span>
                            <span class="n">axis_off</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span>
                            <span class="n">fmt_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis_off</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_model_3d</span><span class="p">(</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">element_labels</span><span class="p">,</span> <span class="n">offset_nd_label</span><span class="p">,</span> <span class="n">axis_off</span><span class="p">,</span>
                            <span class="n">az_el</span><span class="p">,</span> <span class="n">fig_wi_he</span><span class="p">,</span> <span class="n">fig_lbrt</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">local_axes</span><span class="p">,</span> <span class="n">nodes_only</span><span class="p">,</span>
                            <span class="n">fmt_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis_off</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ndim: </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> not supported yet.&#39;</span><span class="p">)</span>

    <span class="c1"># plt.show()  # call this from main py file for more control</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_supports_and_loads_2d"><a class="viewcode-back" href="../plot_supports_and_loads_2d.html#opsvis.plot_supports_and_loads_2d">[docs]</a><span class="k">def</span> <span class="nf">plot_supports_and_loads_2d</span><span class="p">(</span><span class="n">nep</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">sfac</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the supports and the loads applied to the 2d beam-column models</span>
<span class="sd">    (nodal and element loads).</span>

<span class="sd">    Args:</span>
<span class="sd">        nep (int): number of arrows when displacing element distributed loads</span>
<span class="sd">            (default: 17)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeTags</span><span class="p">()</span>
    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>
    <span class="n">ndf</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDF</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># calculate sfac</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="n">Wx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">waa</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">wab</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">### get Ew data</span>
    <span class="n">Ew</span> <span class="o">=</span> <span class="n">get_Ew_data_from_ops_domain</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_tags</span><span class="p">:</span>

        <span class="c1"># by default no element load</span>
        <span class="n">ele_load_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">Ew</span><span class="p">:</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">Ew</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

        <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="c1"># element x, y coordinates</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># step 1: first plot model itself</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                 <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># step 2</span>
        <span class="n">Lxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxy</span> <span class="o">@</span> <span class="n">Lxy</span><span class="p">)</span>
        <span class="n">cosa</span><span class="p">,</span> <span class="n">cosb</span> <span class="o">=</span> <span class="n">Lxy</span> <span class="o">/</span> <span class="n">L</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sfac</span><span class="p">:</span>
            <span class="n">sfac</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">L</span>

        <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nep</span><span class="p">)</span>
        <span class="n">xl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># xl2 = np.logspace(0., 1., nep) * L / nep</span>
        <span class="n">dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
        <span class="c1"># dxs = np.array([0.15, 0.2, 0.275, 0.375])</span>
        <span class="n">xl3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dxs</span><span class="p">))</span> <span class="o">*</span> <span class="n">L</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>
        <span class="c1"># pl = ops.eleResponse(ele_tag, &#39;localForces&#39;)</span>

        <span class="c1"># s_all, xl, nep = section_force_distribution_2d(ex, ey, pl, nep, ele_load_data)</span>

        <span class="k">for</span> <span class="n">ele_load_data_i</span> <span class="ow">in</span> <span class="n">ele_load_data</span><span class="p">:</span>
            <span class="n">ele_load_type</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamPoint&#39;</span><span class="p">:</span>
                <span class="n">Pt</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Pa</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">aL</span><span class="o">*</span><span class="n">L</span>

                <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Pt</span><span class="p">)</span>

                <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># s_0 = [ex[0], ey[0]]</span>

                <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cosa</span>
                <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cosb</span>

                <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

                <span class="n">s_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosb</span>
                <span class="n">s_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosa</span>


                <span class="c1"># plot arrows</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">s_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="c1"># width = 0.01,</span>
                          <span class="n">head_starts_at_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># default False</span>
                          <span class="c1"># overhang=0.2,</span>
                          <span class="c1"># lw = 1,</span>
                          <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span>
                          <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                          <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Pt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="c1"># plt.annotate(&quot;&quot;,</span>
                <span class="c1">#              xy=(s_p[0], s_p[1]), xycoords=&#39;data&#39;,</span>
                <span class="c1">#              xytext=(s_0[0], s_0[1]), textcoords=&#39;data&#39;,</span>
                <span class="c1">#              arrowprops=dict(arrowstyle=&quot;-&gt;&quot;, color=&#39;r&#39;, lw=3,</span>
                <span class="c1">#                              connectionstyle=&quot;arc3&quot;))</span>

            <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="s1">&#39;-beamUniform&#39;</span><span class="p">:</span>

                <span class="n">n_ele_load_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele_load_data_i</span><span class="p">)</span>

                <span class="c1"># constant uniform element load</span>
                <span class="k">if</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># eload_type, Wy, Wx = ele_load_data[0], ele_load_data[1], ele_load_data[2]</span>
                    <span class="n">Wy</span><span class="p">,</span> <span class="n">Wx</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="n">Wy</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">Wx</span><span class="si">}</span><span class="s1">&#39;</span>

                    <span class="c1"># s = sfac * Wy * one</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">one</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">Wy</span><span class="p">)</span>
                    <span class="c1"># plt.text(sum(ex)/2, sum(ey)/2, f&#39;q = {Wy}, {Wx}&#39;, va=&#39;bottom&#39;, ha=&#39;center&#39;, color=&#39;r&#39;)</span>


                <span class="c1"># triangular or trapezoidal element load</span>
                <span class="k">elif</span> <span class="n">n_ele_load_data</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span> <span class="o">=</span> <span class="n">ele_load_data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
                    <span class="n">text_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;q = </span><span class="si">{</span><span class="n">wta</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">waa</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">aL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">bL</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">wtb</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">wab</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">aL</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> <span class="n">bL</span><span class="o">*</span><span class="n">L</span>

                    <span class="n">bma</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>

                    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nep</span><span class="p">)</span>

                    <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">xl</span><span class="p">):</span>
                        <span class="n">xma</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span>
                        <span class="n">wtx</span> <span class="o">=</span> <span class="n">wta</span> <span class="o">+</span> <span class="p">(</span><span class="n">wtb</span> <span class="o">-</span> <span class="n">wta</span><span class="p">)</span> <span class="o">*</span> <span class="n">xma</span> <span class="o">/</span> <span class="n">bma</span>

                        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
                            <span class="n">s</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtx</span>
                        <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                            <span class="k">pass</span>

                        <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sfac</span>

                <span class="n">s_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nep</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosa</span>
                <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosb</span>

                <span class="n">s_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">s_0</span><span class="p">)</span>

                <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosb</span>
                <span class="n">s_p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cosa</span>
                <span class="c1"># plt.axis(&#39;equal&#39;)</span>

                <span class="c1"># reference perpendicular lines</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nep</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                              <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                              <span class="c1"># width = 0.005,</span>
                              <span class="c1"># lw = 2,</span>
                              <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span>
                              <span class="n">head_starts_at_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># default False</span>
                              <span class="c1"># overhang=0.5,</span>
                              <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                              <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                <span class="c1"># connecting beg-end line - redundant ?</span>
                <span class="c1"># plt.plot([s_p[0, 0], s_p[-1, 0]],[s_p[0, 1], s_p[-1, 1]], &#39;r&#39;)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">text_string</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">Wx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># for i, xl in enumerate(xl2[:-1]):</span>
                    <span class="c1">#     plt.arrow(sa[i, 0], sa[i, 1],</span>
                    <span class="c1">#               sa[i+1, 0]-sa[i, 0], sa[i+1, 1]-sa[i, 1],</span>
                    <span class="c1">#               width = 0.01,</span>
                    <span class="c1">#               # lw = 1,</span>
                    <span class="c1">#               # head_width=0.02, head_length=0.05,</span>
                    <span class="c1">#               # head_starts_at_zero=True,  # default False</span>
                    <span class="c1">#               # overhang=0.5,</span>
                    <span class="c1">#               fc=&#39;m&#39;, ec=&#39;m&#39;,</span>
                    <span class="c1">#               length_includes_head=True, shape=&#39;full&#39;)</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                               <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s_0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">s_0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                               <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">waa</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">wab</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosa</span>
                    <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xl3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cosb</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xl3</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="c1"># width = 0.05,</span>
                                  <span class="n">width</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">L</span><span class="p">,</span>
                                  <span class="c1"># lw = 1,</span>
                                  <span class="c1"># head_width=0.02, head_length=0.05,</span>
                                  <span class="c1"># head_starts_at_zero=True,  # default False</span>
                                  <span class="c1"># overhang=0.5,</span>
                                  <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span>
                                  <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>

                    <span class="c1"># plt.quiver(sa[:-1, 0], sa[:-1, 1],</span>
                    <span class="c1">#            sa[1:, 0]-sa[:-1, 0], sa[1:, 1]-sa[:-1, 1],</span>
                    <span class="c1">#            scale_units=&#39;xy&#39;, angles=&#39;xy&#39;, scale=0.8, color=&#39;g&#39;)</span>

                    <span class="c1"># plt.plot([s_0[i, 0], s_p[i, 0]], [s_0[i, 1], s_p[i, 1]],</span>
                    <span class="c1">#          fmt_secforce, solid_capstyle=&#39;round&#39;,</span>
                    <span class="c1">#          solid_joinstyle=&#39;round&#39;, dash_capstyle=&#39;butt&#39;,</span>
                    <span class="c1">#          dash_joinstyle=&#39;round&#39;)</span>
                    <span class="c1"># plot arrows</span>
                    <span class="c1"># plt.annotate(&quot;&quot;,</span>
                    <span class="c1">#              xy=(s_p[i, 0], s_p[i, 1]), xycoords=&#39;data&#39;,</span>
                    <span class="c1">#              xytext=(s_0[i, 0], s_0[i, 1]), textcoords=&#39;data&#39;,</span>
                    <span class="c1">#              arrowprops=dict(arrowstyle=&quot;-&gt;&quot;, color=&#39;r&#39;, lw=2,</span>
                    <span class="c1">#                              connectionstyle=&quot;arc3&quot;))</span>

    <span class="k">for</span> <span class="n">node_tag</span> <span class="ow">in</span> <span class="n">node_tags</span><span class="p">:</span>
        <span class="n">nd_crd</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="c1"># display support symbols: fix - square, triangle - pin, circle - roller</span>
        <span class="n">node_dofs</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeDOFs</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>

        <span class="n">marker_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">ndf</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;^m&#39;</span>
            <span class="k">elif</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;om&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;sm&#39;</span>
            <span class="k">elif</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;^m&#39;</span>
            <span class="k">elif</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">node_dofs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;om&#39;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker_type</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># alternative plot of supports - less readable</span>
        <span class="c1"># for i, node_dof in enumerate(node_dofs):</span>
        <span class="c1">#     if i == 0 and node_dof == -1:</span>
        <span class="c1">#         support_type, support_color = &#39;-&#39;, &#39;m&#39;</span>
        <span class="c1">#     if i == 1 and node_dof == -1:</span>
        <span class="c1">#         support_type, support_color = &#39;|&#39;, &#39;m&#39;</span>
        <span class="c1">#     if i == 2 and node_dof == -1:</span>
        <span class="c1">#         support_type, support_color = &#39;R&#39;, &#39;m&#39;</span>

        <span class="c1">#     plt.text(nd_crd[0], nd_crd[1], support_type, color=support_color,</span>
        <span class="c1">#              va=&#39;center&#39;, ha=&#39;center&#39;, weight=&#39;bold&#39;, fontsize=32)</span>

        <span class="c1"># 2. nodal loads</span>
        <span class="n">nodal_loads</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">nodeUnbalance</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>
        <span class="n">nodal_loads_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kier</span> <span class="ow">in</span> <span class="n">nodal_loads_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># horizontal or vertical nodal force (load)</span>
                <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.</span>

                    <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
                        <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="n">sfac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">kier2</span><span class="p">)</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span>
                              <span class="c1"># width = 0.01,</span>
                              <span class="c1"># head_starts_at_zero=True,  # default False</span>
                              <span class="c1"># overhang=0.2,</span>
                              <span class="n">lw</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                              <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">sfac</span><span class="p">,</span>
                              <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                              <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;P = </span><span class="si">{</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

                <span class="c1"># concentrated bending moment</span>
                <span class="k">elif</span> <span class="n">kier</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">kier2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kier2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;anti-clockwise&#39;</span>
                        <span class="c1"># marker_type=r&#39;$\circlearrowleft$&#39;</span>
                        <span class="n">marker_type</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\curvearrowleft$&#39;</span>
                    <span class="k">elif</span> <span class="n">kier2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pos_or_neg</span> <span class="o">=</span> <span class="s1">&#39;clockwise&#39;</span>
                        <span class="c1"># marker_type=r&#39;$\circlearrowright$&#39;</span>
                        <span class="n">marker_type</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\curvearrowright$&#39;</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker_type</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nd_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nd_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;M = </span><span class="si">{</span><span class="n">nodal_loads</span><span class="p">[</span><span class="n">kier</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">get_nodal_loads_from_ops_domain</span><span class="p">():</span>
    <span class="n">load_at_nodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ibeg</span><span class="p">,</span> <span class="n">iend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">node_load_tags_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeLoadTags</span><span class="p">()</span>
    <span class="n">node_load_data_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNodeLoadData</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">node_load_tag</span> <span class="ow">in</span> <span class="n">node_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">load_at_nodes</span><span class="p">[</span><span class="n">node_load_tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node_load_tag</span> <span class="ow">in</span> <span class="n">node_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">ndf</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getNDF</span><span class="p">(</span><span class="n">node_load_tag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">ndf</span>
        <span class="n">node_load_data</span> <span class="o">=</span> <span class="n">node_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
        <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
        <span class="n">load_at_nodes</span><span class="p">[</span><span class="n">node_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_load_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">load_at_nodes</span>


<span class="k">def</span> <span class="nf">get_Ew_data_from_ops_domain</span><span class="p">():</span>

    <span class="n">Ew</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ibeg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ele_load_tags_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadTags</span><span class="p">()</span>
    <span class="n">ele_load_types_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadClassTags</span><span class="p">()</span>
    <span class="n">ele_load_data_all_patterns</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleLoadData</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="n">ele_load_tags_all_patterns</span><span class="p">:</span>
        <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># iterate over ele_load_tags/classtags</span>
    <span class="k">for</span> <span class="n">ele_load_type</span><span class="p">,</span> <span class="n">ele_load_tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ele_load_types_all_patterns</span><span class="p">,</span>
                                           <span class="n">ele_load_tags_all_patterns</span><span class="p">):</span>

        <span class="c1"># -beamUniform</span>
        <span class="k">if</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wy</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ele_load_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wx</span><span class="p">])</span>
        <span class="c1"># -beamUniform partial</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPartialUniformLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPartialUniformLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">wta</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">wab</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamUniform&#39;</span><span class="p">,</span> <span class="n">wta</span><span class="p">,</span> <span class="n">waa</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">wtb</span><span class="p">,</span> <span class="n">wab</span><span class="p">])</span>
        <span class="c1"># -beamPoint</span>
        <span class="k">elif</span> <span class="n">ele_load_type</span> <span class="o">==</span> <span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPointLoad</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span><span class="o">+</span><span class="n">LoadTag</span><span class="o">.</span><span class="n">Beam2dPointLoad_ndata</span>
            <span class="n">ele_load_data</span> <span class="o">=</span> <span class="n">ele_load_data_all_patterns</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">ibeg</span> <span class="o">=</span> <span class="n">iend</span>
            <span class="n">Pt</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">aL</span> <span class="o">=</span> <span class="n">ele_load_data</span>
            <span class="n">Ew</span><span class="p">[</span><span class="n">ele_load_tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-beamPoint&#39;</span><span class="p">,</span> <span class="n">Pt</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">Pa</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! ele_load_type:</span><span class="se">\n</span><span class="si">{</span><span class="n">ele_load_type</span><span class="si">}</span><span class="s1"> - Unknown element load Error&#39;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">Ew</span>


<div class="viewcode-block" id="plot_extruded_shapes_3d"><a class="viewcode-back" href="../plot_extruded_model_rect_section_3d.html#opsvis.plot_extruded_shapes_3d">[docs]</a><span class="k">def</span> <span class="nf">plot_extruded_shapes_3d</span><span class="p">(</span><span class="n">ele_shapes</span><span class="p">,</span> <span class="n">az_el</span><span class="o">=</span><span class="n">az_el</span><span class="p">,</span>
                            <span class="n">fig_wi_he</span><span class="o">=</span><span class="n">fig_wi_he</span><span class="p">,</span>
                            <span class="n">fig_lbrt</span><span class="o">=</span><span class="n">fig_lbrt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot an extruded 3d model based on cross-section dimenions.</span>

<span class="sd">    Three arrows present local section axes: green - local x-axis,</span>
<span class="sd">    red - local z-axis, blue - local y-axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        ele_shapes (dict): keys are ele_tags and values are lists of:</span>
<span class="sd">            shape_type (str): &#39;rect&#39; - rectangular shape, &#39;I&#39; - double T shape</span>
<span class="sd">            and shape_args (list): list of floats, which necessary section</span>
<span class="sd">            dimensions.</span>
<span class="sd">            For &#39;rect&#39; the list is [b d]; width and depth,</span>
<span class="sd">            for &#39;I&#39; shape - [bf d tw tf]; flange width, section depth, web</span>
<span class="sd">            and flange thicknesses</span>
<span class="sd">            Example: ele_shapes = {1: [&#39;rect&#39;, [b, d]],</span>
<span class="sd">            2: [&#39;I&#39;, [bf, d, tw, tf]]}</span>

<span class="sd">        az_el (tuple): azimuth and elevation</span>

<span class="sd">        fig_wi_he: figure width and height in centimeters</span>

<span class="sd">        fig_lbrt: figure left, bottom, right, top boundaries</span>

<span class="sd">    Usage:</span>
<span class="sd">        ::</span>

<span class="sd">            ele_shapes = {1: [&#39;circ&#39;, [b]],</span>
<span class="sd">                          2: [&#39;rect&#39;, [b, h]],</span>
<span class="sd">                          3: [&#39;I&#39;, [b, h, b/10., h/6.]]}</span>
<span class="sd">            opsv.plot_extruded_shapes_3d(ele_shapes)</span>

<span class="sd">    Notes:</span>

<span class="sd">    - For now only rectangular, circular and double T sections are supported.</span>

<span class="sd">    - This function can be a source of inconsistency because OpenSees lacks</span>
<span class="sd">      functions to return section dimensions. A workaround is to have own</span>
<span class="sd">      Python helper functions to reuse data specified once</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ele_tags</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">getEleTags</span><span class="p">()</span>

    <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">az_el</span>
    <span class="n">fig_wi</span><span class="p">,</span> <span class="n">fig_he</span> <span class="o">=</span> <span class="n">fig_wi_he</span>
    <span class="n">fleft</span><span class="p">,</span> <span class="n">fbottom</span><span class="p">,</span> <span class="n">fright</span><span class="p">,</span> <span class="n">ftop</span> <span class="o">=</span> <span class="n">fig_lbrt</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_wi</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span> <span class="n">fig_he</span><span class="o">/</span><span class="mf">2.54</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.985</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.94</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">Axes3D</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># ax.axis(&#39;equal&#39;)  # bug in matplotlib - does not work for 3d</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele_tags</span><span class="p">):</span>

        <span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleNodes</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">)</span>

        <span class="c1"># element x, y coordinates</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd1</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">ops</span><span class="o">.</span><span class="n">nodeCoord</span><span class="p">(</span><span class="n">nd2</span><span class="p">)[</span><span class="mi">2</span><span class="p">]])</span>

        <span class="c1"># mesh outline</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                <span class="n">solid_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">dash_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span>
                <span class="n">dash_joinstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

        <span class="c1"># eo = Eo[i, :]</span>
        <span class="n">xloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;xlocal&#39;</span><span class="p">)</span>
        <span class="n">yloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;ylocal&#39;</span><span class="p">)</span>
        <span class="n">zloc</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">eleResponse</span><span class="p">(</span><span class="n">ele_tag</span><span class="p">,</span> <span class="s1">&#39;zlocal&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="n">zloc</span><span class="p">))</span>

        <span class="n">G</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

        <span class="c1"># by default empty</span>
        <span class="n">shape_type</span><span class="p">,</span> <span class="n">shape_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;circ&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">ele_tag</span> <span class="ow">in</span> <span class="n">ele_shapes</span><span class="p">:</span>
            <span class="n">shape_type</span><span class="p">,</span> <span class="n">shape_args</span> <span class="o">=</span> <span class="n">ele_shapes</span><span class="p">[</span><span class="n">ele_tag</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_rect</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                      <span class="n">shape_args</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_double_T</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                          <span class="n">shape_args</span><span class="p">)</span>

            <span class="c1"># plot 3d sides</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">Poly3DCollection</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                                                 <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">_plot_extruded_shapes_3d_circ</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span>
                                                    <span class="n">shape_args</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">)</span>

        <span class="c1"># common for all members</span>
        <span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ez</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">alen</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">L</span>

        <span class="c1"># plot local axis directional vectors: workaround quiver = arrow</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                   <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                   <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Xm</span><span class="p">,</span> <span class="n">Ym</span><span class="p">,</span> <span class="n">Zm</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                   <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">alen</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_double_T</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">bf</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">shape_args</span>

    <span class="n">za</span><span class="p">,</span> <span class="n">zb</span> <span class="o">=</span> <span class="n">tw</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">bf</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ya</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">tf</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">g10a</span><span class="p">,</span> <span class="n">g11a</span><span class="p">,</span> <span class="n">g12a</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ya</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ya</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ya</span>
    <span class="n">g10b</span><span class="p">,</span> <span class="n">g11b</span><span class="p">,</span> <span class="n">g12b</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">yb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">yb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">yb</span>

    <span class="n">g20a</span><span class="p">,</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">g22a</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">za</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">za</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">za</span>
    <span class="n">g20b</span><span class="p">,</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">g22b</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">zb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">zb</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">zb</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># beg node (I) cross-section vertices crds, counter-clockwise order</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="c1"># end node (J) cross-section vertices</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">-</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">-</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">-</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>

    <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20a</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21a</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22a</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10a</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11a</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12a</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10b</span> <span class="o">+</span> <span class="n">g20b</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11b</span> <span class="o">+</span> <span class="n">g21b</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12b</span> <span class="o">+</span> <span class="n">g22b</span><span class="p">]</span>

    <span class="c1"># list of sides</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
              <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]],</span>  <span class="c1"># beg</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span>
              <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]],</span>  <span class="c1"># end</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">]],</span>  <span class="c1"># bot 1</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span>  <span class="c1"># top 2</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">]],</span>  <span class="c1"># 3</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]],</span>  <span class="c1"># 4</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">23</span><span class="p">]],</span>  <span class="c1"># 5</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">12</span><span class="p">]],</span>  <span class="c1"># 6</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]],</span>  <span class="c1"># 7</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">]],</span>  <span class="c1"># 8</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">22</span><span class="p">]],</span>  <span class="c1"># 9</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">14</span><span class="p">]],</span>  <span class="c1"># 10</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">19</span><span class="p">]],</span>  <span class="c1"># 11</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">15</span><span class="p">]]]</span>  <span class="c1"># 12</span>

    <span class="k">return</span> <span class="n">verts</span>


<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_rect</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">shape_args</span>
    <span class="n">b2</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">g10</span><span class="p">,</span> <span class="n">g11</span><span class="p">,</span> <span class="n">g12</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">d2</span>
    <span class="n">g20</span><span class="p">,</span> <span class="n">g21</span><span class="p">,</span> <span class="n">g22</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">b2</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># beg node cross-section vertices</span>
    <span class="c1"># collected i-beg, j-end node coordinates, counter-clockwise order</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="c1"># end node cross-section vertices</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">-</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">-</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">-</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>
    <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g10</span> <span class="o">+</span> <span class="n">g20</span><span class="p">,</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g11</span> <span class="o">+</span> <span class="n">g21</span><span class="p">,</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g12</span> <span class="o">+</span> <span class="n">g22</span><span class="p">]</span>

    <span class="c1"># list of 4-node sides</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>  <span class="c1"># beg</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>  <span class="c1"># end</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>  <span class="c1"># bottom</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>  <span class="c1"># top</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>  <span class="c1"># front</span>
             <span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>  <span class="c1"># back</span>

    <span class="k">return</span> <span class="n">verts</span>


<span class="k">def</span> <span class="nf">_plot_extruded_shapes_3d_circ</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">shape_args</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">shape_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># subdivde member length</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># subdivide circle</span>

    <span class="n">xl</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
         <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span>


<span class="k">def</span> <span class="nf">bar_length</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])):</span>
    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">L</span>


<span class="c1"># duplicate - the same function is in defo.py</span>
<span class="k">def</span> <span class="nf">rot_transf_3d</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>

    <span class="n">Lxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ez</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Lxyz</span> <span class="o">@</span> <span class="n">Lxyz</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([[</span><span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">g</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>

<span class="c1"># default settings</span>

<span class="c1"># fmt: format string setting color, marker and linestyle</span>
<span class="c1"># check documentation on matplotlib&#39;s plot</span>

<span class="c1"># continuous interpolated shape line</span>
<span class="n">fmt_interp</span> <span class="o">=</span> <span class="s1">&#39;b-&#39;</span>  <span class="c1"># blue solid line, no markers</span>

<span class="c1"># element end nodes</span>
<span class="n">fmt_nodes</span> <span class="o">=</span> <span class="s1">&#39;rs&#39;</span>  <span class="c1"># red square markers, no line</span>

<span class="c1"># initial model</span>
<span class="n">fmt_model</span> <span class="o">=</span> <span class="s1">&#39;b.-&#39;</span>  <span class="c1"># blue solid line, nodes as dot markers</span>

<span class="c1"># deformed model</span>
<span class="n">fmt_defo</span> <span class="o">=</span> <span class="s1">&#39;b-&#39;</span>  <span class="c1"># green dashed line, no markers</span>

<span class="c1"># undeformed model</span>
<span class="n">fmt_undefo</span> <span class="o">=</span> <span class="s1">&#39;g:&#39;</span>  <span class="c1"># green dotted line, no markers</span>

<span class="c1"># section forces</span>
<span class="n">fmt_secforce</span> <span class="o">=</span> <span class="s1">&#39;b-&#39;</span>  <span class="c1"># blue solid line</span>

<span class="c1"># figure left right bottom top offsets</span>
<span class="n">fig_lbrt</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.04</span><span class="p">,</span> <span class="mf">.04</span><span class="p">,</span> <span class="mf">.96</span><span class="p">,</span> <span class="mf">.96</span><span class="p">)</span>

<span class="c1"># azimuth and elevation in degrees</span>
<span class="n">az_el</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.</span><span class="p">,</span> <span class="mf">30.</span><span class="p">)</span>

<span class="c1"># figure width and height in centimeters</span>
<span class="n">fig_wi_he</span> <span class="o">=</span> <span class="p">(</span><span class="mf">16.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EleClassTag</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;ELE_TAG constants defined in SRC/classTags.h&quot;&quot;&quot;</span>
    <span class="n">truss</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">CorotTruss</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">ZeroLength</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">ZeroLengthSection</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">ElasticBeam2d</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ElasticBeam3d</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">DispBeamColumn2d</span> <span class="o">=</span> <span class="mi">62</span>
    <span class="n">DispBeamColumn3d</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">ForceBeamColumn2d</span> <span class="o">=</span> <span class="mi">73</span>
    <span class="n">ForceBeamColumn3d</span> <span class="o">=</span> <span class="mi">74</span>
    <span class="n">TimoshenkoBeamColumn2d</span> <span class="o">=</span> <span class="mi">63</span>
    <span class="n">ElasticTimoshenkoBeam2d</span> <span class="o">=</span> <span class="mi">145</span>
    <span class="n">ElasticTimoshenkoBeam3d</span> <span class="o">=</span> <span class="mi">146</span>
    <span class="n">tri3n</span> <span class="o">=</span> <span class="mi">33</span>
    <span class="n">tri6n</span> <span class="o">=</span> <span class="mi">209</span>
    <span class="n">quad4n</span> <span class="o">=</span> <span class="mi">31</span>
    <span class="n">quad4n3d</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">quad9n</span> <span class="o">=</span> <span class="mi">207</span>
    <span class="n">quad8n</span> <span class="o">=</span> <span class="mi">208</span>
    <span class="n">SSPquad</span> <span class="o">=</span> <span class="mi">119</span>
    <span class="n">EnhancedQuad</span> <span class="o">=</span> <span class="mi">59</span>
    <span class="n">brick20n</span> <span class="o">=</span> <span class="mi">49</span>
    <span class="n">brick8n</span> <span class="o">=</span> <span class="mi">56</span>
    <span class="n">SSPbrick</span> <span class="o">=</span> <span class="mi">121</span>
    <span class="n">FourNodeTetrahedron</span> <span class="o">=</span> <span class="mi">179</span>
    <span class="n">TenNodeTetrahedron</span> <span class="o">=</span> <span class="mi">1790</span>
    <span class="n">ASDShellQ4</span> <span class="o">=</span> <span class="mi">203</span>
    <span class="n">ASDShellT3</span> <span class="o">=</span> <span class="mi">204</span>
    <span class="n">ShellMITC4</span> <span class="o">=</span> <span class="mi">53</span>
    <span class="n">ShellMITC9</span> <span class="o">=</span> <span class="mi">54</span>


<span class="k">class</span> <span class="nc">LoadTag</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;LOAD_TAG constants defined in SRC/classTags.h&quot;&quot;&quot;</span>
    <span class="n">Beam2dUniformLoad</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">Beam2dUniformLoad_ndata</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">Beam2dPointLoad</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">Beam2dPointLoad_ndata</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">Beam3dUniformLoad</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">Beam3dPointLoad</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">BrickSelfWeight</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">Beam2dTempLoad</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">SurfaceLoader</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">SelfWeight</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Beam2dThermalAction</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">Beam2dPartialUniformLoad</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">Beam2dPartialUniformLoad_ndata</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="n">Beam3dPartialUniformLoad</span> <span class="o">=</span> <span class="mi">121</span>
    <span class="n">Beam3dThermalAction</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">ShellThermalAction</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">NodalThermalAction</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">ThermalActionWrapper</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">LysmerVelocityLoader</span> <span class="o">=</span> <span class="mi">17</span>
<span class="c1"># OpenSeesPy visualization module</span>

<span class="c1"># Copyright (C) 2022 Seweryn Kokot</span>
<span class="c1"># Faculty of Civil Engineering and Architecture</span>
<span class="c1"># Opole University of Technology, Poland</span>
<span class="c1"># License: GNU GPL version 3</span>


<span class="c1"># import openseespy.opensees as ops  # installed from pip</span>
<span class="kn">import</span> <span class="nn">opensees</span> <span class="k">as</span> <span class="nn">ops</span>  <span class="c1"># local compilation</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Wedge</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">tri</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Seweryn Kokot.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>